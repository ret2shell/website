import{c as T,y as le,q as C,b as K,d as G,j as t,e,k as n,S as M,l as O,r as de,F as fe,A as me,v as he,M as z,O as pe,t as l,i as L,B as X,m as Z,f as ge,o as ve,u as _e}from"./index-DHCM5LJk.js";import{L as $e}from"./logo-animate-DwzBVVhL.js";import{p as w,T as xe}from"./header-C2rgC6oY.js";import{B as j}from"./button-CWvnh7OL.js";import{C as U}from"./card-D1oJOCbi.js";import{L as W}from"./link-C85afmZZ.js";import{P as ye}from"./popover-C_nceKuQ.js";import{d as I,e as R,a as J}from"./index-DzhbeeeD.js";import{S as be}from"./spin-B3vkVWkZ.js";import{P as ae}from"./user-DLuZu1WC.js";import{a as A}from"./toast-Bmssr5_f.js";import{A as we}from"./article-OyBfJmMV.js";import{D as ee}from"./divider-D2gFZMAr.js";import{E as Se}from"./editor-CCtxy95a.js";import{I as te}from"./input-Cs8V4IvD.js";import{T as ke}from"./timepicker-DZ7W1KNt.js";import{D as $}from"./datetime-P2UEB0PT.js";import{c as Ce}from"./Form-CGI4Segl.js";import{s as re}from"./setValues-D24qEHVO.js";import{r as F}from"./required-C9pyDEac.js";import{A as je}from"./components-Dq7YmzrW.js";import"./use-environment-context-CrE27ks0.js";import"./popover-root-Bs3_F_Uf.js";import"./use-presence-context-C0VfJ-0L.js";import"./use-locale-context-Bwyb0cy2.js";import"./loading-tips-D8Ukv1g_.js";import"./loading-tips-CelvmSQ5.js";import"./_commonjsHelpers-Cpj98o6Y.js";import"./setValue-Bf_BOLWD.js";async function Ee(r,o){return(await I.get(`${R}/calendar`,{searchParams:{start_time:Math.floor(r.toSeconds()),end_time:Math.floor(o.toSeconds())}})).json()}async function Me(r){return await I.get(`${R}/calendar/${r}`).json()}async function De(r){return await I.post(`${R}/calendar`,{json:r}).json()}async function Te(r){return await I.patch(`${R}/calendar/${r.id}`,{json:r}).json()}async function Oe(r){return await I.delete(`${R}/calendar/${r}`).json()}var qe=l('<h1 class="text-3xl text-center font-bold mt-8 hover:underline"><a target=_blank rel=noreferrer>'),Pe=l('<span class="icon-[fluent--person-20-regular] w-5 h-5">'),Y=l("<span>"),Ne=l('<button class="font-bold hover:underline flex flex-row space-x-2 items-center"type=button><span class="icon-[fluent--edit-20-regular] w-5 h-5"></span><span>'),Fe=l('<button class="font-bold hover:underline flex flex-row space-x-2 items-center"type=button><span class="icon-[fluent--delete-20-regular] w-5 h-5"></span><span>'),Ae=l('<div class="flex flex-row items-center justify-center space-x-6 opacity-60 flex-wrap"><a class="font-bold hover:underline flex flex-row space-x-2 items-center"target=_blank rel=noreferrer><span class="icon-[fluent--link-20-regular] w-5 h-5"></span><span>'),Le=l('<h1 class="text-3xl text-center font-bold mt-8">'),ne=l('<div class="flex flex-col lg:flex-row space-y-2 lg:space-y-0 lg:space-x-4">'),Ie=l('<span class="icon-[fluent--flag-20-regular] w-5 h-5">'),Re=l('<span class="icon-[fluent--link-20-regular] w-5 h-5">'),Be=l('<span class="icon-[fluent--chevron-double-left-20-regular] w-5 h-5">'),Ve=l('<span class="icon-[fluent--chevron-left-20-regular] w-5 h-5">'),Ke=l("<span>-"),We=l('<span class="icon-[fluent--add-20-regular] w-5 h-5">'),Ye=l('<span class="icon-[fluent--chevron-right-20-regular] w-5 h-5">'),He=l('<span class="icon-[fluent--chevron-double-right-20-regular] w-5 h-5">'),ze=l('<div class="flex flex-row space-x-2">'),Ge=l('<div class="hidden lg:grid grid-cols-7 gap-2">'),Ue=l('<div class="flex-1 flex flex-col items-center justify-center space-y-8 opacity-60"><span class="icon-[fluent--flag-20-regular] w-24 h-24"></span><span>'),Je=l('<div class="flex flex-col items-center w-full min-h-full"><div class="flex flex-col w-full max-w-5xl flex-1 p-3 lg:p-6 space-y-2">'),Qe=l('<div class="w-full h-full overflow-hidden flex flex-col lg:flex-row"><div class="flex-none flex flex-col p-3 lg:p-6 backdrop-blur sticky top-0 border-r border-r-layer-content/10">'),Xe=l('<div class="h-12 min-w-12 w-full flex justify-center items-center font-bold opacity-60">'),Ze=l('<span class="absolute h-1 w-3 bottom-2 left-1/2 -translate-x-1/2 flex flex-row space-x-1 bg-primary rounded-full">'),et=l('<div class="mt-2 flex-1 flex flex-row items-center justify-center space-x-2 opacity-60 p-3"><span class="icon-[fluent--person-walking-20-regular] w-5 h-5"></span><span>'),tt=l('<span class="flex-1 text-start">'),rt=l("<span class=opacity-60>");function nt(r){return[(()=>{var o=qe(),p=o.firstChild;return t(p,()=>r.event.name),O(()=>L(p,"href",r.event.link)),o})(),(()=>{var o=Ae(),p=o.firstChild,d=p.firstChild,x=d.nextSibling;return t(o,e(je,{class:"font-bold hover:underline flex flex-row space-x-2 items-center",get href(){return`/users/${r.event.reporter_id}`},get children(){return[Pe(),(()=>{var g=Y();return t(g,()=>n("calendar.addBy",{name:r.event.reporter_name||n("calendar.unknown")})),g})(),Y()]}}),p),t(x,()=>n("calendar.gotoEventHomePage")),t(o,e(M,{get when(){return J.permissions.includes(ae.Calendar)},get children(){return[(()=>{var g=Ne(),y=g.firstChild,m=y.nextSibling;return X(g,"click",r.onEdit,!0),t(m,()=>n("form.edit")),g})(),(()=>{var g=Fe(),y=g.firstChild,m=y.nextSibling;return X(g,"click",r.onDeleted,!0),t(m,()=>n("form.delete")),g})()]}}),null),O(()=>L(p,"href",r.event.link)),o})(),e(we,{get content(){return r.event.intro||""},extra:!0,headingAnchors:!0})]}function lt(r){const[o,{Form:p,Field:d}]=Ce(),[x,g]=T(!1);K(()=>{r.editSource?G(()=>{re(o,{name:r.editSource.name,intro:r.editSource.intro||"",link:r.editSource.link,start_at:r.editSource.start_at.toSeconds(),end_at:r.editSource.end_at.toSeconds()})}):G(()=>{re(o,{name:void 0,intro:void 0,link:void 0,start_at:void 0,end_at:void 0})})});function y(m){g(!0),(r.editSource?Te:De)({...m,id:r.editSource?.id||0,start_at:$.fromSeconds(m.start_at),end_at:$.fromSeconds(m.end_at),reporter_id:J.id}).then(u=>r.onDone(u)).catch(u=>{u.response.text().then(h=>{A({level:"error",description:`${r.editSource?n("calendar.saveFailed"):n("calendar.createFailed")}: ${h}`,duration:5e3})})}).finally(()=>{g(!1)})}return[(()=>{var m=Le();return t(m,(()=>{var u=C(()=>!!r.editSource);return()=>u()?n("calendar.editEvent"):n("calendar.createEvent")})()),m})(),e(p,{onSubmit:y,class:"flex flex-col space-y-2",get children(){return[(()=>{var m=ne();return t(m,e(d,{name:"name",get validate(){return[F(n("calendar.eventNameRequired"))]},children:(u,h)=>e(te,Z({get icon(){return Ie()},get placeholder(){return n("calendar.eventNamePlaceholder")},get title(){return n("calendar.eventNamePlaceholder")}},h,{get value(){return u.value},get error(){return u.error},required:!0,class:"flex-1"}))}),null),t(m,e(d,{name:"link",get validate(){return[F(n("calendar.eventLinkRequired"))]},children:(u,h)=>e(te,Z({get icon(){return Re()},get placeholder(){return n("calendar.eventLinkPlaceholder")},get title(){return n("calendar.eventLinkPlaceholder")}},h,{get value(){return u.value},get error(){return u.error},required:!0,class:"flex-1"}))}),null),m})(),(()=>{var m=ne();return t(m,e(d,{name:"start_at",type:"number",get validate(){return[F(n("calendar.startAtRequired"))]},children:u=>e(d,{name:"end_at",type:"number",get validate(){return[F(n("calendar.endAtRequired"))]},children:h=>e(ke,{form:o,type:"date",range:!0,get title(){return n("calendar.startEndTime")},get placeholder(){return n("calendar.startEndTime")},get name(){return u.name},get value(){return u.value},get nameNext(){return h.name},get valueNext(){return h.value},get error(){return u.error||h.error}})})}),null),t(m,e(d,{name:"intro",get validate(){return[F(n("calendar.introRequired"))]},children:u=>e(Se,{form:o,lineNumbers:!0,class:"flex-1 min-h-80 lg:min-h-auto",lang:"markdown",placeholder:"MARKDOWN",get title(){return n("calendar.introPlaceholder")},name:"intro",get value(){return u.value},get error(){return u.error}})}),null),m})(),e(j,{type:"submit",level:"primary",class:"!mt-4",get loading(){return x()},get disabled(){return x()},get children(){return C(()=>!!r.editSource)()?n("form.save"):n("form.create")}})]}})]}function at(){const r=$.now(),[o,p]=T(r.year),[d,x]=T(r.month),[g,y]=le(),[m,u]=T(!1),h=C(()=>{if(g?.event)try{return Number.parseInt(g.event)}catch{return null}return null}),[_,k]=T(null);K(()=>{h()?G(()=>{k(null),Me(h()).then(i=>{k(i)})}):k(null)});const[q,D]=T(h()===null?r:null);function N(i){switch(i){case 0:return"calendar.day.sun";case 1:return"calendar.day.mon";case 2:return"calendar.day.tue";case 3:return"calendar.day.wed";case 4:return"calendar.day.thu";case 5:return"calendar.day.fri";case 6:return"calendar.day.sat";default:return"calendar.day.sun"}}const f=C(()=>{const i=[],v=$.fromObject({year:o(),month:d(),day:1}),a=v.minus({month:1}),s=v,c=s.daysInMonth;let E=s.startOf("month").weekday;E===7&&(E=0);const V=a.daysInMonth,ce=V-E,ue=(7-(E+c)%7)%7;for(let S=ce;S<V;S++)i.push($.fromObject({year:a.year,month:a.month,day:S+1}));for(let S=0;S<c;S++)i.push($.fromObject({year:s.year,month:s.month,day:S+1}));for(let S=0;S<ue;S++)i.push($.fromObject({year:s.year,month:s.month+1,day:S+1}));return i}),[b,H]=T([]);function P(i,v){Ee(i,v).then(a=>{H(a)}).catch(a=>{a.response.text().then(s=>{A({level:"error",description:`${n("calendar.fetchFailed")}: ${s}`,duration:5e3})})})}K(()=>{const i=$.fromObject({year:o(),month:d(),day:1}),v=i.endOf("month");P(i,v)}),K(()=>{const i=$.fromObject({year:o(),month:d(),day:1});D(null),r.year===i.year&&r.month===i.month&&D(r)});const B=C(()=>{const i=new Set;for(const v of b()){const a=v.start_at,s=v.end_at;for(let c=a;c<=s;c=c.set({day:c.day+1}))i.add(c)}return Array.from(i)}),Q=C(()=>q()===null?[]:b().filter(i=>{const v=i.start_at,a=i.end_at;return v<=q()&&a>=q()}));function se(i){A({level:"success",description:_()?n("calendar.saveSuccess"):n("calendar.createSuccess"),duration:5e3}),P($.fromObject({year:o(),month:d(),day:1}),$.fromObject({year:o(),month:d(),day:1}).endOf("month")),y({event:i.id}),u(!1),k(i)}function oe(){u(!0)}function ie(){h()&&Oe(h()).then(()=>{A({level:"success",description:n("calendar.deleteSuccess"),duration:5e3}),k(null),P($.fromObject({year:o(),month:d(),day:1}),$.fromObject({year:o(),month:d(),day:1}).endOf("month"))}).catch(i=>{i.response.text().then(v=>{A({level:"error",description:`${n("calendar.deleteFailed")}: ${v}`,duration:5e3})})})}return(()=>{var i=Qe(),v=i.firstChild;return t(v,e(U,{contentClass:"p-2 flex flex-col space-y-2",get children(){return[(()=>{var a=ze();return t(a,e(j,{class:"hidden md:inline-flex",ghost:!0,square:!0,onClick:()=>p(o()-1),get title(){return n("calendar.jumpToPrevYear")},get children(){return Be()}}),null),t(a,e(j,{ghost:!0,square:!0,onClick:()=>{d()===1?(p(o()-1),x(12)):x(d()-1)},get title(){return n("calendar.jumpToPrevMonth")},get children(){return Ve()}}),null),t(a,e(j,{ghost:!0,class:"flex-1",onClick:()=>{p(r.year),x(r.month)},get title(){return n("calendar.jumpToToday")},get children(){var s=Ke(),c=s.firstChild;return t(s,()=>o().toString().padStart(4,"0"),c),t(s,()=>d().toString().padStart(2,"0"),null),s}}),null),t(a,e(M,{get when(){return J.permissions?.includes(ae.Calendar)},get children(){return e(j,{ghost:!0,square:!0,onClick:()=>{u(!0),y({event:null}),D(null),k(null)},get children(){return We()}})}}),null),t(a,e(j,{ghost:!0,square:!0,onClick:()=>{d()===12?(p(o()+1),x(1)):x(d()+1)},get title(){return n("calendar.jumpToNextMonth")},get children(){return Ye()}}),null),t(a,e(j,{class:"hidden md:inline-flex",ghost:!0,square:!0,onClick:()=>p(o()+1),get title(){return n("calendar.jumpToNextYear")},get children(){return He()}}),null),a})(),e(ee,{class:"hidden lg:inline-block"}),(()=>{var a=Ge();return t(a,()=>Array.from({length:7}).map((s,c)=>(()=>{var E=Xe();return t(E,()=>n(N(c))),E})()),null),t(a,()=>f().map(s=>e(j,{get ghost(){return C(()=>!(_()?.start_at&&_().start_at<=s&&_()?.end_at&&_().end_at>=s))()&&q()!==s},square:!0,get class(){return`relative ${s.month===d()?"":"opacity-30"}`},onClick:()=>{D(s),y({event:null})},get children(){return[(()=>{var c=Y();return t(c,()=>s.day.toString().padStart(2,"0")),O(()=>c.classList.toggle("text-primary",r.year===o()&&r.month===d()&&r.day===s.day)),c})(),e(M,{get when(){return B().find(c=>c.day===s.day&&c.month===s.month&&c.year===s.year)},get children(){return Ze()}})]}})),null),a})()]}}),null),t(v,e(ee,{class:"mt-3 mb-1 lg:mt-6 lg:mb-4"}),null),t(v,e(fe,{get each(){return b()},get fallback(){return(()=>{var a=et(),s=a.firstChild,c=s.nextSibling;return t(c,()=>n("calendar.noGames")),a})()},children:a=>e(W,{ghost:!0,justify:"start",get class(){return`mt-2 ${a.id===h()?"btn-active":""}`},get href(){return`/?event=${a.id}`},onClick:()=>{D(null),u(!1)},get disabled(){return C(()=>h()===a.id)()&&_()?.id!==a.id},get children(){return[e(M,{get when(){return C(()=>h()===a.id)()&&_()?.id!==a.id},get fallback(){return(()=>{var s=Y();return O(()=>de(s,`icon-[fluent--flag-20-${Q().find(c=>c.id===a.id)||h()===a.id?"filled":"regular"}] w-5 h-5 text-${Q().find(c=>c.id===a.id)||h()===a.id?"primary":"layer-content"}`)),s})()},get children(){return e(be,{width:20,height:20})}}),(()=>{var s=tt();return t(s,()=>a.name),s})(),(()=>{var s=rt();return t(s,()=>a.start_at.toFormat("MM-dd")),s})()]}})}),null),t(i,e(pe,{get options(){return{scrollbars:{theme:`os-theme-${me()}`,autoHide:"scroll"}}},class:"flex-1 relative",defer:!0,get children(){var a=Je(),s=a.firstChild;return t(s,e(he,{get children(){return[e(z,{get when(){return m()},get children(){return e(lt,{onDone:se,get editSource(){return _()||void 0}})}}),e(z,{get when(){return C(()=>!m())()&&_()!==null},get children(){return e(nt,{get event(){return _()},onEdit:oe,onDeleted:ie})}}),e(z,{when:!0,get children(){var c=Ue(),E=c.firstChild,V=E.nextSibling;return t(V,()=>n("calendar.selectGameToSeeDetail")),c}})]}})),a}}),null),i})()}ge(["click"]);var st=l("<span>(C) 2022 - "),ot=l("<a class=hover:underline target=_blank rel=noreferrer>"),it=l("<span class=opacity-40>|"),ct=l("<a class=hover:underline href=https://beian.miit.gov.cn target=_blank rel=noreferrer>"),ut=l("<span>"),dt=l('<span class="icon-[fluent--chevron-double-down-20-regular] w-5 h-5">'),ft=l('<span class="icon-[fluent--gift-20-regular] w-5 h-5">'),mt=l("<span class=text-warning>DEV"),ht=l('<div class="flex flex-col space-y-1"><h2 class="text-2xl font-bold flex flex-row"><span class=text-primary>R</span><span class=opacity-80>et</span><span class=opacity-60>&nbsp;2&nbsp;</span><span class=text-error>S</span><span class=opacity-80>hell</span></h2><p class="text-base font-bold opacity-60 space-x-2"><span>'),pt=l('<a href=mailto:support@ret.sh.cn class="flex-1 btn btn-sm btn-ghost justify-start"target=_blank rel=noreferrer><span class="icon-[fluent--mail-20-regular] w-5 h-5"></span><span class="font-normal opacity-60">support@ret.sh.cn'),gt=l('<span class="icon-[fluent--flash-sparkle-20-regular] w-5 h-5">'),vt=l('<span class="icon-[fluent--open-20-regular] w-5 h-5">'),_t=l('<div class="w-max flex flex-col space-y-2">'),$t=l('<section id=index-calendar class="h-full min-h-full snap-center relative overflow-scroll">'),xt=l('<div class="flex-1 relative"><div class="absolute h-full w-full overflow-scroll snap-mandatory snap-y"><section class="h-full min-h-full snap-center flex flex-col items-center justify-center relative"><div class=flex-1></div><h1 class="text-3xl font-bold opacity-80">&nbsp;&nbsp;<span>[&nbsp;<!>&nbsp;]</span>&nbsp;<span class="text-primary animate-ping">_</span></h1><a class="text-xl text-error mt-8"target=_blank rel=noreferrer></a><div class=flex-1></div><div class=h-24></div><div class="absolute bottom-4 flex flex-row flex-wrap items-center justify-center h-auto p-2 space-x-2 opacity-60">'),yt=l('<span class="icon-[fluent--info-20-regular] w-5 h-5">'),bt=l("<span class=text-primary>REL");function Xt(){const[r]=le();let o;return ve(()=>{if(r.event)try{Number.parseInt(r.event)&&setTimeout(()=>{o.scrollIntoView({behavior:"smooth"})},1e3)}catch{}}),[e(xe,{get title(){return w.config.name||n("platform.name")}}),(()=>{var p=xt(),d=p.firstChild,x=d.firstChild,g=x.firstChild,y=g.nextSibling,m=y.firstChild,u=m.nextSibling,h=u.firstChild,_=h.nextSibling;_.nextSibling;var k=y.nextSibling,q=k.nextSibling,D=q.nextSibling,N=D.nextSibling;return t(u,()=>w.config.name||n("platform.name"),_),t(k,()=>w.config.subject_info||n("platform.subject")),t(N,e(j,{ghost:!0,class:"inline-flex flex-row space-x-1 flex-wrap h-auto max-w-full",get children(){return[(()=>{var f=st();return f.firstChild,t(f,()=>new Date().getFullYear(),null),f})(),(()=>{var f=ot();return t(f,()=>w.config.footer_info),O(()=>L(f,"href",w.config.footer_url||"#")),f})(),e(M,{get when(){return w.config.record},get children(){return[it(),(()=>{var f=ct();return t(f,()=>w.config.record),f})()]}})]}}),null),t(N,e(j,{ghost:!0,onClick:()=>{document.getElementById("index-calendar")?.scrollIntoView({behavior:"smooth"})},get children(){return[(()=>{var f=ut();return t(f,()=>n("calendar.scrollToView")),f})(),dt()]}}),null),t(N,e(M,{get when(){return!w.config.hide_maker},get children(){return[e(W,{square:!0,href:"/magic/sakana",ghost:!0,get children(){return ft()}}),e(ye,{ghost:!0,popContentClass:"pb-2",square:!0,get btnContent(){return yt()},get children(){var f=_t();return t(f,e(U,{contentClass:"flex flex-row items-center space-x-6 p-4 px-8",get children(){return[e($e,{width:64,height:64}),(()=>{var b=ht(),H=b.firstChild,P=H.nextSibling,B=P.firstChild;return t(P,e(M,{get when(){return(w.version||"UNKNOWN").includes("*")},get fallback(){return bt()},get children(){return mt()}}),B),t(B,()=>(w.version||"UNKNOWN").replace("*","")),b})()]}}),null),t(f,e(U,{contentClass:"flex flex-row p-2 space-x-2",get children(){return[(()=>{var b=pt();return O(()=>L(b,"title",n("about.contactTips"))),b})(),e(W,{href:"https://afdian.net/a/reverier",ghost:!0,size:"sm",square:!0,get title(){return n("about.donate")},target:"_blank",get children(){return gt()}}),e(W,{href:"https://github.com/ret2shell",ghost:!0,size:"sm",square:!0,get title(){return n("about.source")},target:"_blank",get children(){return vt()}})]}}),null),f}})]}}),null),t(d,e(M,{get when(){return w.isOnline},get children(){var f=$t(),b=o;return typeof b=="function"?_e(b,f):o=f,t(f,e(at,{})),f}}),null),O(()=>L(k,"href",w.config.subject_url||"#")),p})()]}export{Xt as default};
