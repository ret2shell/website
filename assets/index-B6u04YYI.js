import{c as $,k as d,a as Z,e as i,j as t,S as w,F as B,q as S,l as ee,r as I,i as te,t as m,u as ne}from"./index-D-4Ec2E9.js";import{e as re,a as le}from"./index-CDuUghHV.js";import{c as z}from"./platform-B4gXhAik.js";import{p as ae,T as se}from"./header-C4_4FixI.js";import{a as A}from"./toast-RiaHQnvP.js";import{B as M}from"./button-jqW8_kUd.js";import{L as ie}from"./loading-tips-CriPG-RJ.js";import{T as oe}from"./tag-DrsoVY_V.js";import{D as ce}from"./datetime-P2UEB0PT.js";import"./spin-Cv0qhUOt.js";import"./loading-tips-Bo-x9fE6.js";var W=m("<span>"),de=m('<div class="h-8 flex flex-row items-center space-x-2 border-b border-b-layer-content/10 overflow-hidden min-w-0">'),fe=m('<div class="flex-1 flex flex-col items-center justify-center space-y-8 opacity-60"><span class="icon-[fluent--code-20-regular] w-24 h-24"></span><span></span><span>'),pe=m('<div class="flex-1 flex flex-col"><div class="sticky top-16 h-16 z-20 backdrop-blur border-b border-b-layer-content/10 flex flex-row space-x-4 items-center px-3 lg:px-6"><h1 class="flex-1 font-bold flex flex-row space-x-2 items-center"><span class="icon-[fluent--code-20-regular] w-5 h-5"></span><span></span></h1></div><div class="flex flex-row flex-wrap p-3 lg:p-6 !pb-0"></div><div class="flex-1 flex flex-col p-3 lg:p-6"><div>'),me=m('<span class="icon-[fluent--folder-zip-20-regular] w-8 h-8 flex-shrink-0">'),ue=m("<span class=truncate>"),ge=m('<div class="h-8 flex flex-row items-center space-x-2 border-b border-b-layer-content/10 overflow-hidden min-w-0"><span></span><span class=opacity-40>[<!>]</span><span></span><span class="opacity-60 font-bold">'),y=m("<span class=opacity-60>[<!>]");function Re(){const[G,k]=$(!1),[v,T]=$(!1),[C,L]=$([]);let f;const[H,q]=$([]);z().then(r=>{q(r)}).catch(r=>{r.response.text().then(o=>{A({level:"error",description:`${d("admin.logs.failedToFetchLogsList")}: ${o}`,duration:5e3})})});const[F,E]=$(null);function J(r){E(r),z(r).then(o=>{const b=window.URL.createObjectURL(o),g=document.createElement("a");g.href=b,g.download=r,g.click(),window.URL.revokeObjectURL(b),E(null)})}function O(){f&&(f.onclose=null,f.close()),L([]),T(!1)}function P(){D(),T(!0)}function D(){f=new WebSocket(`${re}/platform/logs/stream?token=${le.token}`),k(!0),f.onopen=()=>{k(!1),L([])},f.onmessage=r=>{const o=JSON.parse(r.data);L(C().concat(o)),setTimeout(()=>{R.scrollIntoView({behavior:"smooth"})},100)},f.onclose=()=>{A({level:"error",description:d("admin.logs.socketClosed"),duration:5e3}),setTimeout(()=>{D()},5e3)},f.onerror=()=>{f.close()}}Z(O);function V(r){switch(r){case"INFO":return"text-info";case"WARN":return"text-warning";case"ERROR":return"text-error";case"DEBUG":return"text-gray-500";default:return"text-info"}}function K(r){switch(r){case"INFO":return"text-layer-content";case"WARN":return"text-warning";case"ERROR":return"text-error";case"DEBUG":return"opacity-60";default:return"text-layer-content"}}let R;return[i(se,{get title(){return`${d("admin.logs.title")} - ${ae.config.name||d("platform.name")}`}}),(()=>{var r=pe(),o=r.firstChild,b=o.firstChild,g=b.firstChild,Q=g.nextSibling,N=o.nextSibling,_=N.nextSibling,x=_.firstChild;t(Q,()=>d("admin.logs.title")),t(o,i(w,{get when(){return v()},get children(){return i(oe,{level:"success",get children(){var e=W();return t(e,()=>d("admin.logs.streamingEnabled")),e}})}}),null),t(o,i(M,{onClick:()=>v()?O():P(),size:"sm",get level(){return v()?"error":"info"},get children(){var e=W();return t(e,()=>`${v()?d("admin.logs.stop"):d("admin.logs.start")}`),e}}),null),t(N,i(B,{get each(){return H()},children:e=>i(M,{class:"font-normal flex flex-col !h-auto py-2 m-1 overflow-hidden",get loading(){return F()===e},onClick:()=>J(e),get children(){return[i(w,{get when(){return F()!==e},get children(){return me()}}),(()=>{var s=ue();return t(s,()=>e.replace("ret2shell.","").replace(".log","")),s})()]}})})),t(_,i(B,{get each(){return C()},children:e=>(()=>{var s=ge(),u=s.firstChild,h=u.nextSibling,X=h.firstChild,j=X.nextSibling;j.nextSibling;var p=h.nextSibling,Y=p.nextSibling;return t(u,()=>e.level),t(h,()=>e.target,j),t(s,(()=>{var l=S(()=>!!e.span?.name);return()=>l()&&(()=>{var n=y(),c=n.firstChild,a=c.nextSibling;return a.nextSibling,t(n,()=>e.span.name,a),n})()})(),p),t(s,(()=>{var l=S(()=>!!e.span?.method);return()=>l()&&(()=>{var n=y(),c=n.firstChild,a=c.nextSibling;return a.nextSibling,t(n,()=>e.span.method,a),n})()})(),p),t(s,(()=>{var l=S(()=>!!e.span?.from);return()=>l()&&(()=>{var n=y(),c=n.firstChild,a=c.nextSibling;return a.nextSibling,t(n,()=>e.span.from,a),n})()})(),p),t(s,(()=>{var l=S(()=>!!e.span?.uri);return()=>l()&&(()=>{var n=y(),c=n.firstChild,a=c.nextSibling;return a.nextSibling,t(n,()=>e.span.uri,a),n})()})(),p),t(p,()=>e.fields.message),t(Y,()=>ce.fromISO(e.timestamp).toFormat("yyyy-MM-dd HH:mm:ss")),ee(l=>{var n=`w-16 ${V(e.level)}`,c=`flex-1 truncate w-0 ${K(e.level)}`,a=e.fields.message;return n!==l.e&&I(u,l.e=n),c!==l.t&&I(p,l.t=c),a!==l.a&&te(p,"title",l.a=a),l},{e:void 0,t:void 0,a:void 0}),s})()}),x),t(_,i(w,{get when(){return G()},get children(){var e=de();return t(e,i(ie,{})),e}}),x),t(_,i(w,{get when(){return C().length===0},get children(){var e=fe(),s=e.firstChild,u=s.nextSibling,h=u.nextSibling;return t(u,()=>d("admin.logs.empty")),t(h,()=>d("admin.logs.emptyTips")),e}}),x);var U=R;return typeof U=="function"?ne(U,x):R=x,r})()]}export{Re as default};
