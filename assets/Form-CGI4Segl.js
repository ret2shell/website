var K=Object.defineProperty;var Q=(e,t,i)=>t in e?K(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i;var w=(e,t,i)=>Q(e,typeof t!="symbol"?t+"":t,i);import{c as X,m as N,d,L as A,b as W,a as Y,q as k,s as Z,u as ee,D as te,t as ie}from"./index-DHCM5LJk.js";function c(e){const[t,i]=X(e);return{get:t,set:i}}function ne({initialValues:e={},validateOn:t="submit",revalidateOn:i="input",validate:n}={}){const s=c([]),o=c([]),l=c(),r=c(0),u=c(!1),a=c(!1),v=c(!1),f=c(!1),g=c(!1),h=c(!1),m=c({});return{internal:{initialValues:e,validate:n,validateOn:t,revalidateOn:i,fieldNames:s,fieldArrayNames:o,element:l,submitCount:r,submitting:u,submitted:a,validating:v,touched:f,dirty:g,invalid:h,response:m,fields:{},fieldArrays:{},validators:new Set},get element(){return l.get()},get submitCount(){return r.get()},get submitting(){return u.get()},get submitted(){return a.get()},get validating(){return v.get()},get touched(){return f.get()},get dirty(){return g.get()},get invalid(){return h.get()},get response(){return m.get()}}}function Ee(e){const t=ne(e);return[t,{Form:i=>Fe(N({of:t},i)),Field:i=>me(N({of:t},i)),FieldArray:i=>Ae(N({of:t},i))}]}function x(e,t,i){const{checked:n,files:s,options:o,value:l,valueAsDate:r,valueAsNumber:u}=e;return d(()=>!i||i==="string"?l:i==="string[]"?o?[...o].filter(a=>a.selected&&!a.disabled).map(a=>a.value):n?[...t.value.get()||[],l]:(t.value.get()||[]).filter(a=>a!==l):i==="number"?u:i==="boolean"?n:i==="File"&&s?s[0]:i==="File[]"&&s?[...s]:i==="Date"&&r?r:t.value.get())}function O(e){return[...Object.values(e.internal.fields),...Object.values(e.internal.fieldArrays)]}function F(e,t){return e.internal.fieldArrays[t]}function se(e,t){return+t.replace(`${e}.`,"").split(".")[0]}function _(e,t){B(e,!1).forEach(i=>{const n=d(F(e,i).items.get).length-1;t.filter(s=>s.startsWith(`${i}.`)&&se(i,s)>n).forEach(s=>{t.splice(t.indexOf(s),1)})})}function B(e,t=!0){const i=[...d(e.internal.fieldArrayNames.get)];return t&&_(e,i),i}function re(e,t=!0){const i=[...d(e.internal.fieldNames.get)];return t&&_(e,i),i}function p(e,t){return e.internal.fields[t]}function T(e,t,i){return d(()=>{const n=re(e,i),s=B(e,i);return typeof t=="string"||Array.isArray(t)?(typeof t=="string"?[t]:t).reduce((o,l)=>{const[r,u]=o;return s.includes(l)?(s.forEach(a=>{a.startsWith(l)&&u.add(a)}),n.forEach(a=>{a.startsWith(l)&&r.add(a)})):r.add(l),o},[new Set,new Set]).map(o=>[...o]):[n,s]})}function j(e,t){return(typeof e!="string"&&!Array.isArray(e)?e:t)||{}}function D(e,t){return e.split(".").reduce((i,n)=>i?.[n],t)}let ae=0;function I(){return ae++}function le(e,t){const i=n=>n instanceof Blob?n.size:n;return Array.isArray(e)&&Array.isArray(t)?e.map(i).join()!==t.map(i).join():e instanceof Date&&t instanceof Date?e.getTime()!==t.getTime():Number.isNaN(e)&&Number.isNaN(t)?!1:e!==t}function oe(e,t){d(()=>e.internal.dirty.set(t||O(e).some(i=>i.active.get()&&i.dirty.get())))}function ue(e,t){d(()=>{const i=le(t.startValue.get(),t.value.get());i!==t.dirty.get()&&A(()=>{t.dirty.set(i),oe(e,i)})})}function ce(e,t,i,{on:n,shouldFocus:s=!1}){d(()=>{n.includes((e.internal.validateOn==="submit"?e.internal.submitted.get():t.error.get())?e.internal.revalidateOn:e.internal.validateOn)&&G(e,i,{shouldFocus:s})})}function V(e,t,i,n,s,o){A(()=>{t.value.set(l=>t.transform.reduce((r,u)=>u(r,n),o??l)),t.touched.set(!0),e.internal.touched.set(!0),ue(e,t),ce(e,t,i,{on:s})})}function fe(e,t){if(!F(e,t)){const i=D(t,e.internal.initialValues)?.map(()=>I())||[],n=c(i),s=c(i),o=c(i),l=c(""),r=c(!1),u=c(!1),a=c(!1);e.internal.fieldArrays[t]={initialItems:n,startItems:s,items:o,error:l,active:r,touched:u,dirty:a,validate:[],consumers:new Set},e.internal.fieldArrayNames.set(v=>[...v,t])}return F(e,t)}function de(e,t){if(!p(e,t)){const i=D(t,e.internal.initialValues),n=c([]),s=c(i),o=c(i),l=c(i),r=c(""),u=c(!1),a=c(!1),v=c(!1);e.internal.fields[t]={elements:n,initialValue:s,startValue:o,value:l,error:r,active:u,touched:a,dirty:v,validate:[],transform:[],consumers:new Set},e.internal.fieldNames.set(f=>[...f,t])}return p(e,t)}function ge(e,t,{shouldActive:i=!0}){const n=Object.entries(t).reduce((s,[o,l])=>([p(e,o),F(e,o)].every(r=>!r||i&&!d(r.active.get))&&s.push(l),s),[]).join(" ");n&&e.internal.response.set({status:"error",message:n})}function L(e,t){d(()=>{e.internal.invalid.set(t||O(e).some(i=>i.active.get()&&i.error.get()))})}function C(e){let t=!1,i=!1,n=!1;d(()=>{for(const s of O(e))if(s.active.get()&&(s.touched.get()&&(t=!0),s.dirty.get()&&(i=!0),s.error.get()&&(n=!0)),t&&i&&n)break}),A(()=>{e.internal.touched.set(t),e.internal.dirty.set(i),e.internal.invalid.set(n)})}function M(e,t){d(()=>p(e,t)?.elements.get()[0]?.focus())}function ye(e,t,i,{shouldActive:n=!0,shouldTouched:s=!1,shouldDirty:o=!1,shouldFocus:l=!!i}={}){A(()=>{d(()=>{for(const r of[p(e,t),F(e,t)])r&&(!n||r.active.get())&&(!s||r.touched.get())&&(!o||r.dirty.get())&&(r.error.set(i),i&&"value"in r&&l&&M(e,t))}),L(e,!!i)})}function U(e,t,i){const[n,s]=T(e,t),{shouldActive:o=!0,shouldTouched:l=!1,shouldDirty:r=!1,shouldValid:u=!1}=j(t,i);return typeof t!="string"&&!Array.isArray(t)?e.internal.fieldNames.get():s.forEach(a=>F(e,a).items.get()),n.reduce((a,v)=>{const f=p(e,v);return(!o||f.active.get())&&(!l||f.touched.get())&&(!r||f.dirty.get())&&(!u||!f.error.get())&&(typeof t=="string"?v.replace(`${t}.`,""):v).split(".").reduce((g,h,m,b)=>g[h]=m===b.length-1?f.value.get():typeof g[h]=="object"&&g[h]||(isNaN(+b[m+1])?{}:[]),a),a},typeof t=="string"?[]:{})}function ve(e,t,i){const[n,s]=T(e,t,!1),o=typeof t=="string"&&n.length===1,l=!o&&!Array.isArray(t),r=j(t,i),{initialValue:u,initialValues:a,keepResponse:v=!1,keepSubmitCount:f=!1,keepSubmitted:g=!1,keepValues:h=!1,keepDirtyValues:m=!1,keepItems:b=!1,keepDirtyItems:J=!1,keepErrors:P=!1,keepTouched:$=!1,keepDirty:R=!1}=r;A(()=>d(()=>{n.forEach(E=>{const y=p(e,E);(o?"initialValue"in r:a)&&y.initialValue.set(()=>o?u:D(E,a));const S=m&&y.dirty.get();!h&&!S&&(y.startValue.set(y.initialValue.get),y.value.set(y.initialValue.get),y.elements.get().forEach(z=>{z.type==="file"&&(z.value="")})),$||y.touched.set(!1),!R&&!h&&!S&&y.dirty.set(!1),P||y.error.set("")}),s.forEach(E=>{const y=F(e,E),S=J&&y.dirty.get();!b&&!S&&(a&&y.initialItems.set(D(E,a)?.map(()=>I())||[]),y.startItems.set([...y.initialItems.get()]),y.items.set([...y.initialItems.get()])),$||y.touched.set(!1),!R&&!b&&!S&&y.dirty.set(!1),P||y.error.set("")}),l&&(v||e.internal.response.set({}),f||e.internal.submitCount.set(0),g||e.internal.submitted.set(!1)),C(e)}))}function he(e,t,{duration:i}={}){e.internal.response.set(t),i&&setTimeout(()=>{d(e.internal.response.get)===t&&e.internal.response.set({})},i)}async function G(e,t,i){const[n,s]=T(e,t),{shouldActive:o=!0,shouldFocus:l=!0}=j(t,i),r=I();e.internal.validators.add(r),e.internal.validating.set(!0);const u=e.internal.validate?await e.internal.validate(d(()=>U(e,{shouldActive:o}))):{};let a=typeof t!="string"&&!Array.isArray(t)?!Object.keys(u).length:!0;const[v]=await Promise.all([Promise.all(n.map(async f=>{const g=p(e,f);if(!o||d(g.active.get)){let h;for(const b of g.validate)if(h=await b(d(g.value.get)),h)break;const m=h||u[f]||"";return m&&(a=!1),g.error.set(m),m?f:null}})),Promise.all(s.map(async f=>{const g=F(e,f);if(!o||d(g.active.get)){let h="";for(const b of g.validate)if(h=await b(d(g.items.get)),h)break;const m=h||u[f]||"";m&&(a=!1),g.error.set(m)}}))]);return A(()=>{if(ge(e,u,{shouldActive:o}),l){const f=v.find(g=>g);f&&M(e,f)}L(e,!a),e.internal.validators.delete(r),e.internal.validators.size||e.internal.validating.set(!1)}),a}function H({of:e,name:t,getStore:i,validate:n,transform:s,keepActive:o=!1,keepState:l=!0}){W(()=>{const r=i();r.validate=n?Array.isArray(n)?n:[n]:[],"transform"in r&&(r.transform=s?Array.isArray(s)?s:[s]:[]);const u=I();r.consumers.add(u),d(r.active.get)||A(()=>{r.active.set(!0),C(e)}),Y(()=>setTimeout(()=>{r.consumers.delete(u),A(()=>{!o&&!r.consumers.size&&(r.active.set(!1),l?C(e):ve(e,t))}),"elements"in r&&r.elements.set(a=>a.filter(v=>v.isConnected))}))})}function me(e){const t=k(()=>de(e.of,e.name));return H(N({getStore:t},e)),k(()=>e.children({get name(){return e.name},get value(){return t().value.get()},get error(){return t().error.get()},get active(){return t().active.get()},get touched(){return t().touched.get()},get dirty(){return t().dirty.get()}},{get name(){return e.name},get autofocus(){return!!t().error.get()},ref(i){t().elements.set(n=>[...n,i]),W(()=>{if(i.type!=="radio"&&t().startValue.get()===void 0&&d(t().value.get)===void 0){const n=x(i,t(),e.type);t().startValue.set(()=>n),t().value.set(()=>n)}})},onInput(i){V(e.of,t(),e.name,i,["touched","input"],x(i.currentTarget,t(),e.type))},onChange(i){V(e.of,t(),e.name,i,["change"])},onBlur(i){V(e.of,t(),e.name,i,["touched","blur"])}}))}function Ae(e){const t=k(()=>fe(e.of,e.name));return H(N({getStore:t},e)),k(()=>e.children({get name(){return e.name},get items(){return t().items.get()},get error(){return t().error.get()},get active(){return t().active.get()},get touched(){return t().touched.get()},get dirty(){return t().dirty.get()}}))}class q extends Error{constructor(i,n){super(typeof i=="string"?i:"");w(this,"name","FormError");w(this,"errors");this.errors=typeof i=="string"?n||{}:i}}var be=ie("<form novalidate>");function Fe(e){const[,t,i]=Z(e,["of"],["keepResponse","shouldActive","shouldTouched","shouldDirty","shouldFocus"]);return(()=>{var n=be(),s=e.of.internal.element.set;return typeof s=="function"?ee(s,n):e.of.internal.element.set=n,te(n,N(i,{onSubmit:async o=>{o.preventDefault();const{of:l,onSubmit:r,responseDuration:u}=e;A(()=>{t.keepResponse||l.internal.response.set({}),l.internal.submitCount.set(a=>a+1),l.internal.submitted.set(!0),l.internal.submitting.set(!0)});try{await G(l,t)&&await r(U(l,t),o)}catch(a){A(()=>{a instanceof q&&Object.entries(a.errors).forEach(([v,f])=>{f&&ye(l,v,f,{...t,shouldFocus:!1})}),(!(a instanceof q)||a.message)&&he(l,{status:"error",message:a?.message||"An unknown error has occurred."},{duration:u})})}finally{l.internal.submitting.set(!1)}}}),!1,!1),n})()}export{de as a,ce as b,Ee as c,I as g,fe as i,ue as u,G as v};
