import{f as M,m as f}from"./index-CEtxFafb.js";import"./index-D-4Ec2E9.js";import"./_commonjsHelpers-Cpj98o6Y.js";function q(t,u){const l=String(t);let i=l.indexOf(u),e=i,m=0,h=0;for(;i!==-1;)i===e?++m>h&&(h=m):m=1,e=i+u.length,i=l.indexOf(u,e);return h}function P(){return{enter:{mathFlow:t,mathFlowFenceMeta:u,mathText:m},exit:{mathFlow:e,mathFlowFence:i,mathFlowFenceMeta:l,mathFlowValue:c,mathText:h,mathTextData:c}};function t(r){const o={type:"element",tagName:"code",properties:{className:["language-math","math-display"]},children:[]};this.enter({type:"math",meta:null,value:"",data:{hName:"pre",hChildren:[o]}},r)}function u(){this.buffer()}function l(){const r=this.resume(),o=this.stack[this.stack.length-1];o.type,o.meta=r}function i(){this.data.mathFlowInside||(this.buffer(),this.data.mathFlowInside=!0)}function e(r){const o=this.resume().replace(/^(\r?\n|\r)|(\r?\n|\r)$/g,""),s=this.stack[this.stack.length-1];s.type,this.exit(r),s.value=o;const x=s.data.hChildren[0];x.type,x.tagName,x.children.push({type:"text",value:o}),this.data.mathFlowInside=void 0}function m(r){this.enter({type:"inlineMath",value:"",data:{hName:"code",hProperties:{className:["language-math","math-inline"]},hChildren:[]}},r),this.buffer()}function h(r){const o=this.resume(),s=this.stack[this.stack.length-1];s.type,this.exit(r),s.value=o,s.data.hChildren.push({type:"text",value:o})}function c(r){this.config.enter.data.call(this,r),this.config.exit.data.call(this,r)}}function b(t){let u=(t||{}).singleDollarTextMath;return u==null&&(u=!0),i.peek=e,{unsafe:[{character:"\r",inConstruct:"mathFlowMeta"},{character:`
`,inConstruct:"mathFlowMeta"},{character:"$",after:u?void 0:"\\$",inConstruct:"phrasing"},{character:"$",inConstruct:"mathFlowMeta"},{atBreak:!0,character:"$",after:"\\$"}],handlers:{math:l,inlineMath:i}};function l(m,h,c,r){const o=m.value||"",s=c.createTracker(r),x="$".repeat(Math.max(q(o,"$")+1,2)),w=c.enter("mathFlow");let p=s.move(x);if(m.meta){const F=c.enter("mathFlowMeta");p+=s.move(c.safe(m.meta,{after:`
`,before:p,encode:["$"],...s.current()})),F()}return p+=s.move(`
`),o&&(p+=s.move(o+`
`)),p+=s.move(x),w(),p}function i(m,h,c){let r=m.value||"",o=1;for(u||o++;new RegExp("(^|[^$])"+"\\$".repeat(o)+"([^$]|$)").test(r);)o++;const s="$".repeat(o);/[^ \r\n]/.test(r)&&(/^[ \r\n]/.test(r)&&/[ \r\n]$/.test(r)||/^\$|\$$/.test(r))&&(r=" "+r+" ");let x=-1;for(;++x<c.unsafe.length;){const w=c.unsafe[x];if(!w.atBreak)continue;const p=c.compilePattern(w);let F;for(;F=p.exec(r);){let a=F.index;r.codePointAt(a)===10&&r.codePointAt(a-1)===13&&a--,r=r.slice(0,a)+" "+r.slice(F.index+1)}}return s+r+s}function e(){return"$"}}const D={tokenize:v,concrete:!0},E={tokenize:N,partial:!0};function v(t,u,l){const i=this,e=i.events[i.events.length-1],m=e&&e[1].type==="linePrefix"?e[2].sliceSerialize(e[1],!0).length:0;let h=0;return c;function c(n){return t.enter("mathFlow"),t.enter("mathFlowFence"),t.enter("mathFlowFenceSequence"),r(n)}function r(n){return n===36?(t.consume(n),h++,r):h<2?l(n):(t.exit("mathFlowFenceSequence"),M(t,o,"whitespace")(n))}function o(n){return n===null||f(n)?x(n):(t.enter("mathFlowFenceMeta"),t.enter("chunkString",{contentType:"string"}),s(n))}function s(n){return n===null||f(n)?(t.exit("chunkString"),t.exit("mathFlowFenceMeta"),x(n)):n===36?l(n):(t.consume(n),s)}function x(n){return t.exit("mathFlowFence"),i.interrupt?u(n):t.attempt(E,w,g)(n)}function w(n){return t.attempt({tokenize:z,partial:!0},g,p)(n)}function p(n){return(m?M(t,F,"linePrefix",m+1):F)(n)}function F(n){return n===null?g(n):f(n)?t.attempt(E,w,g)(n):(t.enter("mathFlowValue"),a(n))}function a(n){return n===null||f(n)?(t.exit("mathFlowValue"),F(n)):(t.consume(n),a)}function g(n){return t.exit("mathFlow"),u(n)}function z(n,C,k){let y=0;return M(n,S,"linePrefix",i.parser.constructs.disable.null.includes("codeIndented")?void 0:4);function S(d){return n.enter("mathFlowFence"),n.enter("mathFlowFenceSequence"),T(d)}function T(d){return d===36?(y++,n.consume(d),T):y<h?k(d):(n.exit("mathFlowFenceSequence"),M(n,$,"whitespace")(d))}function $(d){return d===null||f(d)?(n.exit("mathFlowFence"),C(d)):k(d)}}}function N(t,u,l){const i=this;return e;function e(h){return h===null?u(h):(t.enter("lineEnding"),t.consume(h),t.exit("lineEnding"),m)}function m(h){return i.parser.lazy[i.now().line]?l(h):u(h)}}function O(t){let l=(t||{}).singleDollarTextMath;return l==null&&(l=!0),{tokenize:i,resolve:I,previous:L};function i(e,m,h){let c=0,r,o;return s;function s(a){return e.enter("mathText"),e.enter("mathTextSequence"),x(a)}function x(a){return a===36?(e.consume(a),c++,x):c<2&&!l?h(a):(e.exit("mathTextSequence"),w(a))}function w(a){return a===null?h(a):a===36?(o=e.enter("mathTextSequence"),r=0,F(a)):a===32?(e.enter("space"),e.consume(a),e.exit("space"),w):f(a)?(e.enter("lineEnding"),e.consume(a),e.exit("lineEnding"),w):(e.enter("mathTextData"),p(a))}function p(a){return a===null||a===32||a===36||f(a)?(e.exit("mathTextData"),w(a)):(e.consume(a),p)}function F(a){return a===36?(e.consume(a),r++,F):r===c?(e.exit("mathTextSequence"),e.exit("mathText"),m(a)):(o.type="mathTextData",p(a))}}}function I(t){let u=t.length-4,l=3,i,e;if((t[l][1].type==="lineEnding"||t[l][1].type==="space")&&(t[u][1].type==="lineEnding"||t[u][1].type==="space")){for(i=l;++i<u;)if(t[i][1].type==="mathTextData"){t[u][1].type="mathTextPadding",t[l][1].type="mathTextPadding",l+=2,u-=2;break}}for(i=l-1,u++;++i<=u;)e===void 0?i!==u&&t[i][1].type!=="lineEnding"&&(e=i):(i===u||t[i][1].type==="lineEnding")&&(t[e][1].type="mathTextData",i!==e+2&&(t[e][1].end=t[i-1][1].end,t.splice(e+2,i-e-2),u-=i-e-2,i=e+2),e=void 0);return t}function L(t){return t!==36||this.events[this.events.length-1][1].type==="characterEscape"}function _(t){return{flow:{36:D},text:{36:O(t)}}}const A={};function j(t){const u=this,l=t||A,i=u.data(),e=i.micromarkExtensions||(i.micromarkExtensions=[]),m=i.fromMarkdownExtensions||(i.fromMarkdownExtensions=[]),h=i.toMarkdownExtensions||(i.toMarkdownExtensions=[]);e.push(_(l)),m.push(P()),h.push(b(l))}export{j as default};
