import{j as t,e,k as a,A as P,O as T,t as r,c as k,b as W,S as g,q as w,m as Y,F as X,l as q,i as V,f as Z,M as L,v as J,h as B,d as ee,_ as S,w as te,y as re}from"./index-DHCM5LJk.js";import{C as ne}from"./index-2ZsPQDSJ.js";import{S as le}from"./sidebar-layout-DmqsIU0T.js";import{P as A}from"./user-DLuZu1WC.js";import{d as I,e as H,a as h}from"./index-DzhbeeeD.js";import{g as c}from"./game-AtpgpTlS.js";import{T as ae}from"./header-C2rgC6oY.js";import{L as E}from"./link-C85afmZZ.js";import{D as K}from"./datetime-P2UEB0PT.js";import{a as y}from"./toast-Bmssr5_f.js";import{B as D}from"./button-CWvnh7OL.js";import{D as ie}from"./divider-D2gFZMAr.js";import{E as se}from"./editor-CCtxy95a.js";import{I as oe}from"./input-Cs8V4IvD.js";import{L as ce}from"./loading-tips-D8Ukv1g_.js";import{c as ue}from"./Form-CGI4Segl.js";import{r as G}from"./required-C9pyDEac.js";import{A as me}from"./components-Dq7YmzrW.js";import{s as de}from"./setValues-D24qEHVO.js";import{A as fe}from"./article-OyBfJmMV.js";import"./use-environment-context-CrE27ks0.js";import"./use-presence-context-C0VfJ-0L.js";import"./use-locale-context-Bwyb0cy2.js";import"./xdsec-mascot-normal-B0zf2pzB.js";import"./xdsec-mascot-unsee-DC4zWBPN.js";import"./card-D1oJOCbi.js";import"./popover-C_nceKuQ.js";import"./popover-root-Bs3_F_Uf.js";import"./index-CcaEcIBT.js";import"./index-mQdWiL7h.js";import"./spin-B3vkVWkZ.js";import"./_commonjsHelpers-Cpj98o6Y.js";import"./setValue-Bf_BOLWD.js";import"./loading-tips-CelvmSQ5.js";var pe=r('<span class="icon-[fluent--flag-20-filled] w-5 h-5 text-primary">'),he=r("<span>"),ge=r('<div class="border-b border-b-layer-content/10 px-2 h-16 flex items-center justify-center">'),$e=r('<div class="flex flex-col space-y-2 p-3 lg:p-6">'),_e=r('<div class="flex-1 overflow-hidden">');function ve(){return[(()=>{var l=ge();return t(l,e(E,{class:"w-full",ghost:!0,justify:"start",get href(){return`/games/${c.current?.id}/challenges`},get children(){return[pe(),(()=>{var s=he();return t(s,()=>a("game.challenge.list")),s})()]}})),l})(),(()=>{var l=_e();return t(l,e(T,{get options(){return{scrollbars:{theme:`os-theme-${P()}`,autoHide:"scroll"}}},class:"relative w-full h-full print:h-auto print:overflow-auto",defer:!0,get children(){return $e()}})),l})()]}function we(){return[]}async function xe(l){return await I.get(`${H}/game/${l}/notification`).json()}async function be(l,s){return await I.post(`${H}/game/${l}/notification`,{json:s}).json()}async function ye(l,s){return await I.delete(`${H}/game/${l}/notification/${s}`).json()}var z=r('<span class="icon-[fluent--add-20-regular] w-5 h-5">'),N=r("<span>"),ke=r('<span class="icon-[fluent--chevron-double-up-20-regular] w-5 h-5">'),Ce=r('<div class="flex flex-row space-x-2">'),Se=r('<div class="flex flex-col space-y-2 p-3 lg:p-6">'),Ee=r('<div class="w-full h-full overflow-hidden">'),Pe=r('<div class="flex flex-row items-center justify-center space-x-2 opacity-60 p-3">'),Te=r('<span class="icon-[fluent--chat-empty-20-regular] w-5 h-5">'),je=r('<span class="icon-[fluent--person-20-regular] w-5 h-5">'),Ne=r('<button class="flex-shrink-0 flex items-center"type=button><span class="icon-[fluent--delete-20-regular] w-5 h-5">'),Fe=r('<div class="flex flex-col"><h2 class="flex flex-row items-center py-2 space-x-2 font-bold"><span class="flex-shrink-0 icon-[fluent--alert-20-regular] w-5 h-5"></span><span class="flex-1 truncate"></span><span class="flex-shrink-0 icon-[fluent--calendar-20-regular] w-5 h-5"></span></h2><p class="py-2 break-words">');function Le(){const[l,s]=k([]),_=()=>l().sort((d,f)=>f.published_at.toMillis()-d.published_at.toMillis()),[i,m]=k(!1),[$,{Form:M,Field:p}]=ue(),v=d=>{const f={id:0,title:d.title,content:d.content,published_at:K.now(),publisher_id:h.id,game_id:c.current.id};be(c.current.id,f).then(()=>{y({level:"success",description:a("game.notification.createSuccess"),duration:5e3}),de($,{title:"",content:""}),m(!1),C()}).catch(n=>{n.response.text().then(o=>{y({level:"error",description:`${a("game.notification.createFailed")}: ${o}`,duration:5e3})})})},[u,x]=k(!1);function C(){x(!0),xe(c.current.id).then(s).catch(d=>{d.response.text().then(f=>{y({level:"error",description:`${a("game.notification.fetchFailed")}: ${f}`,duration:5e3})})}).finally(()=>{x(!1)})}function Q(d){ye(c.current.id,d).then(()=>{y({level:"success",description:a("game.notification.deleteSuccess"),duration:5e3}),C()}).catch(f=>{f.response.text().then(n=>{y({level:"error",description:`${a("game.notification.deleteFailed")}: ${n}`,duration:5e3})})}).finally(()=>{C()})}return W(()=>{c.current&&C()}),(()=>{var d=Ee();return t(d,e(T,{get options(){return{scrollbars:{theme:`os-theme-${P()}`,autoHide:"scroll"}}},class:"relative w-full h-full print:h-auto print:overflow-auto",defer:!0,get children(){var f=Se();return t(f,e(g,{get when(){return w(()=>!!(h.id&&c.current?.admins.includes(h.id)))()&&h.permissions.includes(A.Game)},get children(){return e(M,{onSubmit:v,class:"flex flex-col space-y-2",get children(){return[e(g,{get when(){return i()},get children(){return[e(p,{name:"title",get validate(){return[G(a("game.notification.titleRequired"))]},children:(n,o)=>e(oe,Y({get placeholder(){return a("game.notification.titlePlaceholder")},get title(){return a("game.notification.titlePlaceholder")}},o,{get value(){return n.value},get error(){return n.error},required:!0}))}),e(p,{name:"content",get validate(){return[G(a("game.notification.contentRequired"))]},children:n=>e(se,{form:$,class:"h-48",lang:"plaintext",placeholder:"PLAINTEXT",get title(){return a("game.notification.contentPlaceholder")},name:"content",get value(){return n.value},get error(){return n.error}})})]}}),(()=>{var n=Ce();return t(n,e(g,{get when(){return i()},get children(){return e(D,{class:"flex-1",type:"submit",get children(){return[z(),(()=>{var o=N();return t(o,()=>a("form.create")),o})()]}})}}),null),t(n,e(D,{get class(){return`${i()?"flex-shrink-0":"flex-1"}`},get square(){return i()},type:"button",onClick:()=>{m(!i())},get children(){return[e(g,{get when(){return i()},get fallback(){return z()},get children(){return ke()}}),e(g,{get when(){return!i()},get children(){var o=N();return t(o,()=>a("form.create")),o}})]}}),null),n})()]}})}}),null),t(f,e(X,{get each(){return _()},get fallback(){return(()=>{var n=Pe();return t(n,e(g,{get when(){return u()},get fallback(){return[Te(),(()=>{var o=N();return t(o,()=>a("game.noNotifications")),o})()]},get children(){return e(ce,{})}})),n})()},children:n=>(()=>{var o=Fe(),b=o.firstChild,U=b.firstChild,R=U.nextSibling;R.nextSibling;var O=b.nextSibling;return t(R,()=>n.title),t(b,e(me,{class:"flex-shrink-0 flex items-center",get href(){return`/users/${n.publisher_id}`},get children(){return je()}}),null),t(b,e(g,{get when(){return w(()=>!!(h.id&&c.current?.admins.includes(h.id)))()&&h.permissions.includes(A.Game)},get children(){var j=Ne();return j.$$click=()=>Q(n.id),q(()=>V(j,"title",a("form.delete"))),j}}),null),t(o,e(ie,{}),O),t(O,()=>n.content),q(()=>V(b,"title",`${n.publisher_name} at ${n.published_at.toFormat("yyyy-MM-dd HH:mm:ss")}`)),o})()}),null),f}})),d})()}Z(["click"]);var Ae=r('<span class="icon-[fluent--person-settings-20-filled] w-5 h-5 text-error">'),De=r("<span>"),Ie=r('<div class="border-b border-b-layer-content/10 px-2 h-16 flex items-center justify-center">');function He(){return(()=>{var l=Ie();return t(l,e(J,{get children(){return e(L,{get when(){return c.current?.admins.includes(h.id)},get children(){return e(D,{ghost:!0,disabled:!0,class:"w-full",justify:"start",get children(){return[Ae(),(()=>{var s=De();return t(s,()=>a("game.adminMode")),s})()]}})}})}})),l})()}var Me=r('<div class="flex flex-col">'),Re=r('<div class="flex-1 w-full relative"><div class="absolute top-0 left-0 w-full h-full overflow-hidden">');function Oe(){const[l,s]=k(null),_=Object.assign({"../../_blocks/contents/welcome.en_us.md":()=>S(()=>import("./welcome.en_us-BpeuZc6f.js"),[]),"../../_blocks/contents/welcome.ja_jp.md":()=>S(()=>import("./welcome.ja_jp-BwVdDEDk.js"),[]),"../../_blocks/contents/welcome.zh_cn.md":()=>S(()=>import("./welcome.zh_cn-C3qm9_Io.js"),[]),"../../_blocks/contents/welcome.zh_tw.md":()=>S(()=>import("./welcome.zh_tw-CJ6T0HgC.js"),[])});return W(()=>{B.locale&&ee(()=>{const i=_[`../../_blocks/contents/welcome.${B.locale}.md`];i().then(m=>{s(m.default)})})}),(()=>{var i=Re(),m=i.firstChild;return t(m,e(T,{get options(){return{scrollbars:{theme:`os-theme-${P()}`,autoHide:"scroll"}}},class:"relative w-full h-full print:h-auto print:overflow-auto",defer:!0,get children(){var $=Me();return t($,e(fe,{class:"self-center",get content(){return l()||""}})),$}})),i})()}var qe=r('<span class="icon-[fluent--home-20-regular] w-5 h-5">'),F=r("<span>"),Ve=r('<span class="icon-[fluent--add-20-regular] w-5 h-5">'),Be=r('<div class="h-full flex px-2 py-0 items-center space-x-2 min-w-max w-max">'),Ge=r('<div class="flex-1 flex flex-col w-0">'),ze=r('<div class="flex flex-col">'),We=r('<span class="icon-[fluent--code-20-regular] w-5 h-5">');function Et(){const l=te();if(h.token===null)return l(`/account/login?redirect=/games/${c.current?c.current.id:""}`),null;const[s,_]=re(),i=w(()=>Number.parseInt(s.challenge||"NaN")||null),m=w(()=>s.create==="true"),[$,M]=k([]);return[e(ae,{get title(){return`${a("game.challenge.title")} - ${c.current?.name||"CTF"}`}}),e(le,{get leftBar(){return e(ve,{})},get rightBar(){return(()=>{var p=ze();return t(p,e(He,{}),null),t(p,e(Le,{}),null),p})()},get children(){var p=Ge();return t(p,e(T,{class:"w-full h-16 backdrop-blur border-b border-b-layer-content/10 relative",get options(){return{scrollbars:{theme:`os-theme-${P()}`,autoHide:"scroll"}}},defer:!0,get children(){var v=Be();return t(v,e(E,{get href(){return`/games/${c.current?.id}/challenges`},onClick:()=>_({challenge:null}),ghost:!0,get active(){return w(()=>i()===null)()&&m()===!1},get children(){return[qe(),(()=>{var u=F();return t(u,()=>a("game.challenge.welcome")),u})()]}}),null),t(v,e(g,{get when(){return h.permissions.includes(A.Game)},get children(){return e(E,{get active(){return m()},get title(){return a("form.create")},ghost:!0,get href(){return`/games/${c.current?.id}/challenges?create=true`},get children(){return[Ve(),(()=>{var u=F();return t(u,()=>a("form.create")),u})()]}})}}),null),t(v,e(X,{get each(){return $()},children:u=>e(E,{get href(){return`/games/${c.current?.id}/challenges?challenge=${u.id}`},onClick:()=>_({challenge:u.id}),get active(){return w(()=>u.id===i())()&&m()===!1},ghost:!0,get children(){return[We(),(()=>{var x=F();return t(x,()=>u.name),x})()]}})}),null),v}}),null),t(p,e(J,{get fallback(){return e(Oe,{})},get children(){return[e(L,{get when(){return m()},get children(){return e(we,{})}}),e(L,{get when(){return i()!==null},get children(){return e(ne,{inGame:!0,get challenge(){return{id:i(),name:"Challenge",score:100,game_id:1,content:"Content",updated_at:K.now(),hidden:!1,tag:[{name:"Reverse",primary:!0}],score_rule:{initial:1e3,minimum:500,decay:10},bucket:""}}})}})]}}),null),p}})]}export{Et as default};
