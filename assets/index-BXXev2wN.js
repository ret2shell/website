import{c as T,y as le,q as k,b as K,d as G,j as t,e,k as l,S as M,l as P,r as de,F as fe,A as me,v as he,M as H,O as pe,t as n,i as W,B as X,m as Z,f as ge,o as ve,u as _e}from"./index-D-4Ec2E9.js";import{L as $e}from"./logo-animate-Dsq31Qvw.js";import{p as b,T as xe}from"./header-C4_4FixI.js";import{B as C}from"./button-jqW8_kUd.js";import{C as U}from"./card-r-C9G86U.js";import{L as A}from"./link-CZfV6CnK.js";import{P as ye}from"./popover-DNwyEML6.js";import{d as I,e as R,a as J}from"./index-CDuUghHV.js";import{S as be}from"./spin-Cv0qhUOt.js";import{P as ae}from"./user-DLuZu1WC.js";import{a as L}from"./toast-RiaHQnvP.js";import{A as we}from"./article-B5D9jRlm.js";import{D as ee}from"./divider-CRTXR2Ng.js";import{E as Se}from"./editor-C8Ki5-IP.js";import{I as te}from"./input-C0wwSomq.js";import{T as ke}from"./timepicker-CK_281ZI.js";import{D as $}from"./datetime-P2UEB0PT.js";import{c as Ce}from"./Form-DGUtLwyz.js";import{s as re}from"./setValues-CxCjsZ5S.js";import{r as F}from"./required-C9pyDEac.js";import{A as je}from"./components-AHWt1IRQ.js";import"./use-environment-context-C2cuRCHg.js";import"./popover-root-C7Ww2Kgi.js";import"./use-presence-context-DB1lc17V.js";import"./use-locale-context-Cw8uL8t2.js";import"./loading-tips-CriPG-RJ.js";import"./loading-tips-Bo-x9fE6.js";import"./_commonjsHelpers-Cpj98o6Y.js";import"./setValue-D3eDTJml.js";async function Ee(r,o){return(await I.get(`${R}/calendar`,{searchParams:{start_time:Math.floor(r.toSeconds()),end_time:Math.floor(o.toSeconds())}})).json()}async function Me(r){return await I.get(`${R}/calendar/${r}`).json()}async function De(r){return await I.post(`${R}/calendar`,{json:r}).json()}async function Te(r){return await I.patch(`${R}/calendar/${r.id}`,{json:r}).json()}async function Oe(r){return await I.delete(`${R}/calendar/${r}`).json()}var qe=n('<h1 class="text-3xl text-center font-bold mt-8 hover:underline"><a target=_blank rel=noreferrer>'),Pe=n('<span class="icon-[fluent--person-20-regular] w-5 h-5">'),Y=n("<span>"),Ne=n('<button class="font-bold hover:underline flex flex-row space-x-2 items-center"type=button><span class="icon-[fluent--edit-20-regular] w-5 h-5"></span><span>'),Fe=n('<button class="font-bold hover:underline flex flex-row space-x-2 items-center"type=button><span class="icon-[fluent--delete-20-regular] w-5 h-5"></span><span>'),Ae=n('<div class="flex flex-row items-center justify-center space-x-6 opacity-60 flex-wrap"><a class="font-bold hover:underline flex flex-row space-x-2 items-center"target=_blank rel=noreferrer><span class="icon-[fluent--link-20-regular] w-5 h-5"></span><span>'),Le=n('<h1 class="text-3xl text-center font-bold mt-8">'),ne=n('<div class="flex flex-col lg:flex-row space-y-2 lg:space-y-0 lg:space-x-4">'),Ie=n('<span class="icon-[fluent--flag-20-regular] w-5 h-5">'),Re=n('<span class="icon-[fluent--link-20-regular] w-5 h-5">'),Be=n('<span class="icon-[fluent--chevron-double-left-20-regular] w-5 h-5">'),Ve=n('<span class="icon-[fluent--chevron-left-20-regular] w-5 h-5">'),Ke=n("<span>-"),We=n('<span class="icon-[fluent--add-20-regular] w-5 h-5">'),Ye=n('<span class="icon-[fluent--chevron-right-20-regular] w-5 h-5">'),ze=n('<span class="icon-[fluent--chevron-double-right-20-regular] w-5 h-5">'),He=n('<div class="flex flex-row space-x-2">'),Ge=n('<div class="hidden lg:grid grid-cols-7 gap-2">'),Ue=n('<div class="flex-1 flex flex-col items-center justify-center space-y-8 opacity-60"><span class="icon-[fluent--flag-20-regular] w-24 h-24"></span><span>'),Je=n('<div class="flex flex-col items-center w-full min-h-full"><div class="flex flex-col w-full max-w-5xl flex-1 p-3 lg:p-6 space-y-2">'),Qe=n('<div class="w-full h-full overflow-hidden flex flex-col lg:flex-row"><div class="flex-none flex flex-col p-3 lg:p-6 backdrop-blur sticky top-0 border-r border-r-layer-content/10">'),Xe=n('<div class="h-12 min-w-12 w-full flex justify-center items-center font-bold opacity-60">'),Ze=n('<span class="absolute h-1 w-3 bottom-2 left-1/2 -translate-x-1/2 flex flex-row space-x-1 bg-primary rounded-full">'),et=n('<div class="mt-2 flex-1 flex flex-row items-center justify-center space-x-2 opacity-60 p-3"><span class="icon-[fluent--person-walking-20-regular] w-5 h-5"></span><span>'),tt=n('<span class="flex-1 text-start">'),rt=n("<span class=opacity-60>");function nt(r){return[(()=>{var o=qe(),p=o.firstChild;return t(p,()=>r.event.name),P(()=>W(p,"href",r.event.link)),o})(),(()=>{var o=Ae(),p=o.firstChild,d=p.firstChild,x=d.nextSibling;return t(o,e(je,{class:"font-bold hover:underline flex flex-row space-x-2 items-center",get href(){return`/users/${r.event.reporter_id}`},get children(){return[Pe(),(()=>{var g=Y();return t(g,()=>l("calendar.addBy",{name:r.event.reporter_name||l("calendar.unknown")})),g})(),Y()]}}),p),t(x,()=>l("calendar.gotoEventHomePage")),t(o,e(M,{get when(){return J.permissions.includes(ae.Calendar)},get children(){return[(()=>{var g=Ne(),y=g.firstChild,m=y.nextSibling;return X(g,"click",r.onEdit,!0),t(m,()=>l("form.edit")),g})(),(()=>{var g=Fe(),y=g.firstChild,m=y.nextSibling;return X(g,"click",r.onDeleted,!0),t(m,()=>l("form.delete")),g})()]}}),null),P(()=>W(p,"href",r.event.link)),o})(),e(we,{get content(){return r.event.intro||""},extra:!0,headingAnchors:!0})]}function lt(r){const[o,{Form:p,Field:d}]=Ce(),[x,g]=T(!1);K(()=>{r.editSource?G(()=>{re(o,{name:r.editSource.name,intro:r.editSource.intro||"",link:r.editSource.link,start_at:r.editSource.start_at.toSeconds(),end_at:r.editSource.end_at.toSeconds()})}):G(()=>{re(o,{name:void 0,intro:void 0,link:void 0,start_at:void 0,end_at:void 0})})});function y(m){g(!0),(r.editSource?Te:De)({...m,id:r.editSource?.id||0,start_at:$.fromSeconds(m.start_at),end_at:$.fromSeconds(m.end_at),reporter_id:J.id}).then(u=>r.onDone(u)).catch(u=>{u.response.text().then(h=>{L({level:"error",description:`${r.editSource?l("calendar.saveFailed"):l("calendar.createFailed")}: ${h}`,duration:5e3})})}).finally(()=>{g(!1)})}return[(()=>{var m=Le();return t(m,(()=>{var u=k(()=>!!r.editSource);return()=>u()?l("calendar.editEvent"):l("calendar.createEvent")})()),m})(),e(p,{onSubmit:y,class:"flex flex-col space-y-2",get children(){return[(()=>{var m=ne();return t(m,e(d,{name:"name",get validate(){return[F(l("calendar.eventNameRequired"))]},children:(u,h)=>e(te,Z({get icon(){return Ie()},get placeholder(){return l("calendar.eventNamePlaceholder")},get title(){return l("calendar.eventNamePlaceholder")}},h,{get value(){return u.value},get error(){return u.error},required:!0,class:"flex-1"}))}),null),t(m,e(d,{name:"link",get validate(){return[F(l("calendar.eventLinkRequired"))]},children:(u,h)=>e(te,Z({get icon(){return Re()},get placeholder(){return l("calendar.eventLinkPlaceholder")},get title(){return l("calendar.eventLinkPlaceholder")}},h,{get value(){return u.value},get error(){return u.error},required:!0,class:"flex-1"}))}),null),m})(),(()=>{var m=ne();return t(m,e(d,{name:"start_at",type:"number",get validate(){return[F(l("calendar.startAtRequired"))]},children:u=>e(d,{name:"end_at",type:"number",get validate(){return[F(l("calendar.endAtRequired"))]},children:h=>e(ke,{form:o,type:"date",range:!0,get title(){return l("calendar.startEndTime")},get placeholder(){return l("calendar.startEndTime")},get name(){return u.name},get value(){return u.value},get nameNext(){return h.name},get valueNext(){return h.value},get error(){return u.error||h.error}})})}),null),t(m,e(d,{name:"intro",get validate(){return[F(l("calendar.introRequired"))]},children:u=>e(Se,{form:o,lineNumbers:!0,class:"flex-1 min-h-80 lg:min-h-auto",lang:"markdown",placeholder:"MARKDOWN",get title(){return l("calendar.introPlaceholder")},name:"intro",get value(){return u.value},get error(){return u.error}})}),null),m})(),e(C,{type:"submit",level:"primary",class:"!mt-4",get loading(){return x()},get disabled(){return x()},get children(){return k(()=>!!r.editSource)()?l("form.save"):l("form.create")}})]}})]}function at(){const r=$.now(),[o,p]=T(r.year),[d,x]=T(r.month),[g,y]=le(),[m,u]=T(!1),h=k(()=>{if(g?.event)try{return Number.parseInt(g.event)}catch{return null}return null}),[_,S]=T(null);K(()=>{h()?G(()=>{S(null),Me(h()).then(i=>{S(i)})}):S(null)});const[O,D]=T(h()===null?r:null);function N(i){switch(i){case 0:return"calendar.day.sun";case 1:return"calendar.day.mon";case 2:return"calendar.day.tue";case 3:return"calendar.day.wed";case 4:return"calendar.day.thu";case 5:return"calendar.day.fri";case 6:return"calendar.day.sat";default:return"calendar.day.sun"}}const f=k(()=>{const i=[],v=$.fromObject({year:o(),month:d(),day:1}),a=v.minus({month:1}),s=v,c=s.daysInMonth;let E=s.startOf("month").weekday;E===7&&(E=0);const V=a.daysInMonth,ce=V-E,ue=(7-(E+c)%7)%7;for(let w=ce;w<V;w++)i.push($.fromObject({year:a.year,month:a.month,day:w+1}));for(let w=0;w<c;w++)i.push($.fromObject({year:s.year,month:s.month,day:w+1}));for(let w=0;w<ue;w++)i.push($.fromObject({year:s.year,month:s.month+1,day:w+1}));return i}),[j,z]=T([]);function q(i,v){Ee(i,v).then(a=>{z(a)}).catch(a=>{a.response.text().then(s=>{L({level:"error",description:`${l("calendar.fetchFailed")}: ${s}`,duration:5e3})})})}K(()=>{const i=$.fromObject({year:o(),month:d(),day:1}),v=i.endOf("month");q(i,v)}),K(()=>{const i=$.fromObject({year:o(),month:d(),day:1});D(null),r.year===i.year&&r.month===i.month&&D(r)});const B=k(()=>{const i=new Set;for(const v of j()){const a=v.start_at,s=v.end_at;for(let c=a;c<=s;c=c.set({day:c.day+1}))i.add(c)}return Array.from(i)}),Q=k(()=>O()===null?[]:j().filter(i=>{const v=i.start_at,a=i.end_at;return v<=O()&&a>=O()}));function se(i){L({level:"success",description:_()?l("calendar.saveSuccess"):l("calendar.createSuccess"),duration:5e3}),q($.fromObject({year:o(),month:d(),day:1}),$.fromObject({year:o(),month:d(),day:1}).endOf("month")),y({event:i.id}),u(!1),S(i)}function oe(){u(!0)}function ie(){h()&&Oe(h()).then(()=>{L({level:"success",description:l("calendar.deleteSuccess"),duration:5e3}),S(null),q($.fromObject({year:o(),month:d(),day:1}),$.fromObject({year:o(),month:d(),day:1}).endOf("month"))}).catch(i=>{i.response.text().then(v=>{L({level:"error",description:`${l("calendar.deleteFailed")}: ${v}`,duration:5e3})})})}return(()=>{var i=Qe(),v=i.firstChild;return t(v,e(U,{contentClass:"p-2 flex flex-col space-y-2",get children(){return[(()=>{var a=He();return t(a,e(C,{class:"hidden md:inline-flex",ghost:!0,square:!0,onClick:()=>p(o()-1),get title(){return l("calendar.jumpToPrevYear")},get children(){return Be()}}),null),t(a,e(C,{ghost:!0,square:!0,onClick:()=>{d()===1?(p(o()-1),x(12)):x(d()-1)},get title(){return l("calendar.jumpToPrevMonth")},get children(){return Ve()}}),null),t(a,e(C,{ghost:!0,class:"flex-1",onClick:()=>{p(r.year),x(r.month)},get title(){return l("calendar.jumpToToday")},get children(){var s=Ke(),c=s.firstChild;return t(s,()=>o().toString().padStart(4,"0"),c),t(s,()=>d().toString().padStart(2,"0"),null),s}}),null),t(a,e(M,{get when(){return J.permissions?.includes(ae.Calendar)},get children(){return e(C,{ghost:!0,square:!0,onClick:()=>{u(!0),y({event:null}),D(null),S(null)},get children(){return We()}})}}),null),t(a,e(C,{ghost:!0,square:!0,onClick:()=>{d()===12?(p(o()+1),x(1)):x(d()+1)},get title(){return l("calendar.jumpToNextMonth")},get children(){return Ye()}}),null),t(a,e(C,{class:"hidden md:inline-flex",ghost:!0,square:!0,onClick:()=>p(o()+1),get title(){return l("calendar.jumpToNextYear")},get children(){return ze()}}),null),a})(),e(ee,{class:"hidden lg:inline-block"}),(()=>{var a=Ge();return t(a,()=>Array.from({length:7}).map((s,c)=>(()=>{var E=Xe();return t(E,()=>l(N(c))),E})()),null),t(a,()=>f().map(s=>e(C,{get ghost(){return k(()=>!(_()?.start_at&&_().start_at<=s&&_()?.end_at&&_().end_at>=s))()&&O()!==s},square:!0,get class(){return`relative ${s.month===d()?"":"opacity-30"}`},onClick:()=>{D(s),y({event:null})},get children(){return[(()=>{var c=Y();return t(c,()=>s.day.toString().padStart(2,"0")),P(()=>c.classList.toggle("text-primary",r.year===o()&&r.month===d()&&r.day===s.day)),c})(),e(M,{get when(){return B().find(c=>c.day===s.day&&c.month===s.month&&c.year===s.year)},get children(){return Ze()}})]}})),null),a})()]}}),null),t(v,e(ee,{class:"mt-3 mb-1 lg:mt-6 lg:mb-4"}),null),t(v,e(fe,{get each(){return j()},get fallback(){return(()=>{var a=et(),s=a.firstChild,c=s.nextSibling;return t(c,()=>l("calendar.noGames")),a})()},children:a=>e(A,{ghost:!0,justify:"start",get class(){return`mt-2 ${a.id===h()?"btn-active":""}`},get href(){return`/?event=${a.id}`},onClick:()=>{D(null),u(!1)},get disabled(){return k(()=>h()===a.id)()&&_()?.id!==a.id},get children(){return[e(M,{get when(){return k(()=>h()===a.id)()&&_()?.id!==a.id},get fallback(){return(()=>{var s=Y();return P(()=>de(s,`icon-[fluent--flag-20-${Q().find(c=>c.id===a.id)||h()===a.id?"filled":"regular"}] w-5 h-5 text-${Q().find(c=>c.id===a.id)||h()===a.id?"primary":"layer-content"}`)),s})()},get children(){return e(be,{width:20,height:20})}}),(()=>{var s=tt();return t(s,()=>a.name),s})(),(()=>{var s=rt();return t(s,()=>a.start_at.toFormat("MM-dd")),s})()]}})}),null),t(i,e(pe,{get options(){return{scrollbars:{theme:`os-theme-${me()}`,autoHide:"scroll"}}},class:"flex-1 relative",defer:!0,get children(){var a=Je(),s=a.firstChild;return t(s,e(he,{get children(){return[e(H,{get when(){return m()},get children(){return e(lt,{onDone:se,get editSource(){return _()||void 0}})}}),e(H,{get when(){return k(()=>!m())()&&_()!==null},get children(){return e(nt,{get event(){return _()},onEdit:oe,onDeleted:ie})}}),e(H,{when:!0,get children(){var c=Ue(),E=c.firstChild,V=E.nextSibling;return t(V,()=>l("calendar.selectGameToSeeDetail")),c}})]}})),a}}),null),i})()}ge(["click"]);var st=n("<span>(C) 2022 - "),ot=n("<a class=hover:underline target=_blank rel=noreferrer>"),it=n("<span class=opacity-40>|"),ct=n("<a class=hover:underline href=https://beian.miit.gov.cn target=_blank rel=noreferrer>"),ut=n("<span>"),dt=n('<span class="icon-[fluent--chevron-double-down-20-regular] w-5 h-5">'),ft=n('<span class="icon-[fluent--gift-20-regular] w-5 h-5">'),mt=n("<span class=text-warning>DEV"),ht=n('<div class="flex flex-col space-y-1"><h2 class="text-2xl font-bold flex flex-row"><span class=text-primary>R</span><span class=opacity-80>et</span><span class=opacity-60>&nbsp;2&nbsp;</span><span class=text-error>S</span><span class=opacity-80>hell</span></h2><p class="text-base font-bold opacity-60 space-x-2"><span>'),pt=n('<span class="icon-[fluent--mail-20-regular] w-5 h-5">'),gt=n('<span class="font-normal opacity-60">ret2shell@woooo.tech'),vt=n('<span class="icon-[fluent--flash-sparkle-20-regular] w-5 h-5">'),_t=n('<span class="icon-[fluent--open-20-regular] w-5 h-5">'),$t=n('<div class="w-max flex flex-col space-y-2">'),xt=n('<section id=index-calendar class="h-full min-h-full snap-center relative overflow-scroll">'),yt=n('<div class="flex-1 relative"><div class="absolute h-full w-full overflow-scroll snap-mandatory snap-y"><section class="h-full min-h-full snap-center flex flex-col items-center justify-center relative"><div class=flex-1></div><h1 class="text-3xl font-bold opacity-80">&nbsp;&nbsp;<span>[&nbsp;<!>&nbsp;]</span>&nbsp;<span class="text-primary animate-ping">_</span></h1><a class="text-xl text-error mt-8"target=_blank rel=noreferrer></a><div class=flex-1></div><div class=h-24></div><div class="absolute bottom-4 flex flex-row flex-wrap items-center justify-center h-auto p-2 space-x-2 opacity-60">'),bt=n('<span class="icon-[fluent--info-20-regular] w-5 h-5">'),wt=n("<span class=text-primary>REL");function Zt(){const[r]=le();let o;return ve(()=>{if(r.event)try{Number.parseInt(r.event)&&setTimeout(()=>{o.scrollIntoView({behavior:"smooth"})},1e3)}catch{}}),[e(xe,{get title(){return b.config.name||l("platform.name")}}),(()=>{var p=yt(),d=p.firstChild,x=d.firstChild,g=x.firstChild,y=g.nextSibling,m=y.firstChild,u=m.nextSibling,h=u.firstChild,_=h.nextSibling;_.nextSibling;var S=y.nextSibling,O=S.nextSibling,D=O.nextSibling,N=D.nextSibling;return t(u,()=>b.config.name||l("platform.name"),_),t(S,()=>b.config.subject_info||l("platform.subject")),t(N,e(C,{ghost:!0,class:"inline-flex flex-row space-x-1 flex-wrap h-auto max-w-full",get children(){return[(()=>{var f=st();return f.firstChild,t(f,()=>new Date().getFullYear(),null),f})(),(()=>{var f=ot();return t(f,()=>b.config.footer_info),P(()=>W(f,"href",b.config.footer_url||"#")),f})(),e(M,{get when(){return b.config.record},get children(){return[it(),(()=>{var f=ct();return t(f,()=>b.config.record),f})()]}})]}}),null),t(N,e(C,{ghost:!0,onClick:()=>{document.getElementById("index-calendar")?.scrollIntoView({behavior:"smooth"})},get children(){return[(()=>{var f=ut();return t(f,()=>l("calendar.scrollToView")),f})(),dt()]}}),null),t(N,e(M,{get when(){return!b.config.hide_maker},get children(){return[e(A,{square:!0,href:"/magic/sakana",ghost:!0,get children(){return ft()}}),e(ye,{ghost:!0,popContentClass:"pb-2",square:!0,get btnContent(){return bt()},get children(){var f=$t();return t(f,e(U,{contentClass:"flex flex-row items-center space-x-6 p-4 px-8",get children(){return[e($e,{width:64,height:64}),(()=>{var j=ht(),z=j.firstChild,q=z.nextSibling,B=q.firstChild;return t(q,e(M,{get when(){return(b.version||"UNKNOWN").includes("*")},get fallback(){return wt()},get children(){return mt()}}),B),t(B,()=>(b.version||"UNKNOWN").replace("*","")),j})()]}}),null),t(f,e(U,{contentClass:"flex flex-row p-2 space-x-2",get children(){return[e(A,{href:"mailto:ret2shell@woooo.tech",ghost:!0,size:"sm",class:"flex-1",justify:"start",get title(){return l("about.contactTips")},target:"_blank",get children(){return[pt(),gt()]}}),e(A,{href:"https://afdian.net/a/reverier",ghost:!0,size:"sm",square:!0,get title(){return l("about.donate")},target:"_blank",get children(){return vt()}}),e(A,{href:"https://github.com/ret2shell",ghost:!0,size:"sm",square:!0,get title(){return l("about.source")},target:"_blank",get children(){return _t()}})]}}),null),f}})]}}),null),t(d,e(M,{get when(){return b.isOnline},get children(){var f=xt(),j=o;return typeof j=="function"?_e(j,f):o=f,t(f,e(at,{})),f}}),null),P(()=>W(S,"href",b.config.subject_url||"#")),p})()]}export{Zt as default};
