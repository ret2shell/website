import{j as t,e,k as a,A as P,O as T,t as r,c as k,b as W,S as g,q as w,m as Y,F as X,l as q,i as B,f as Z,M as L,v as J,h as G,d as ee,_ as S,w as te,y as re}from"./index-D-4Ec2E9.js";import{C as ne}from"./index-Bj0UROWU.js";import{S as le}from"./sidebar-layout-Bu_uU4Ep.js";import{P as A}from"./user-DLuZu1WC.js";import{d as I,e as H,a as h}from"./index-CDuUghHV.js";import{g as c}from"./game-nYWJIA85.js";import{T as ae}from"./header-C4_4FixI.js";import{L as E}from"./link-CZfV6CnK.js";import{D as K}from"./datetime-P2UEB0PT.js";import{a as y}from"./toast-RiaHQnvP.js";import{B as D}from"./button-jqW8_kUd.js";import{D as ie}from"./divider-CRTXR2Ng.js";import{E as se}from"./editor-C8Ki5-IP.js";import{I as oe}from"./input-C0wwSomq.js";import{L as ce}from"./loading-tips-CriPG-RJ.js";import{c as ue}from"./Form-DGUtLwyz.js";import{r as V}from"./required-C9pyDEac.js";import{A as me}from"./components-AHWt1IRQ.js";import{A as de}from"./article-B5D9jRlm.js";import"./use-environment-context-C2cuRCHg.js";import"./use-presence-context-DB1lc17V.js";import"./use-locale-context-Cw8uL8t2.js";import"./xdsec-mascot-normal-B0zf2pzB.js";import"./xdsec-mascot-unsee-DC4zWBPN.js";import"./card-r-C9G86U.js";import"./popover-DNwyEML6.js";import"./popover-root-C7Ww2Kgi.js";import"./index-CqttnvLX.js";import"./index-Oj2p9cu_.js";import"./spin-Cv0qhUOt.js";import"./_commonjsHelpers-Cpj98o6Y.js";import"./setValue-D3eDTJml.js";import"./loading-tips-Bo-x9fE6.js";var fe=r('<span class="icon-[fluent--flag-20-filled] w-5 h-5 text-primary">'),pe=r("<span>"),he=r('<div class="border-b border-b-layer-content/10 px-2 h-16 flex items-center justify-center">'),ge=r('<div class="flex flex-col space-y-2 p-3 lg:p-6">'),$e=r('<div class="flex-1 overflow-hidden">');function _e(){return[(()=>{var l=he();return t(l,e(E,{class:"w-full",ghost:!0,justify:"start",get href(){return`/games/${c.current?.id}/challenges`},get children(){return[fe(),(()=>{var s=pe();return t(s,()=>a("game.challenge.list")),s})()]}})),l})(),(()=>{var l=$e();return t(l,e(T,{get options(){return{scrollbars:{theme:`os-theme-${P()}`,autoHide:"scroll"}}},class:"relative w-full h-full print:h-auto print:overflow-auto",defer:!0,get children(){return ge()}})),l})()]}function ve(){return[]}async function we(l){return await I.get(`${H}/game/${l}/notification`).json()}async function xe(l,s){return await I.post(`${H}/game/${l}/notification`,{json:s}).json()}async function be(l,s){return await I.delete(`${H}/game/${l}/notification/${s}`).json()}var z=r('<span class="icon-[fluent--add-20-regular] w-5 h-5">'),N=r("<span>"),ye=r('<span class="icon-[fluent--chevron-double-up-20-regular] w-5 h-5">'),ke=r('<div class="flex flex-row space-x-2">'),Ce=r('<div class="flex flex-col space-y-2 p-3 lg:p-6">'),Se=r('<div class="w-full h-full overflow-hidden">'),Ee=r('<div class="flex flex-row items-center justify-center space-x-2 opacity-60 p-3">'),Pe=r('<span class="icon-[fluent--chat-empty-20-regular] w-5 h-5">'),Te=r('<span class="icon-[fluent--person-20-regular] w-5 h-5">'),je=r('<button class="flex-shrink-0 flex items-center"type=button><span class="icon-[fluent--delete-20-regular] w-5 h-5">'),Ne=r('<div class="flex flex-col"><h2 class="flex flex-row items-center py-2 space-x-2 font-bold"><span class="flex-shrink-0 icon-[fluent--alert-20-regular] w-5 h-5"></span><span class="flex-1 truncate"></span><span class="flex-shrink-0 icon-[fluent--calendar-20-regular] w-5 h-5"></span></h2><p class="py-2 break-words">');function Fe(){const[l,s]=k([]),$=()=>l().sort((m,d)=>d.published_at.toMillis()-m.published_at.toMillis()),[i,f]=k(!1),[_,{Form:M,Field:p}]=ue(),v=m=>{const d={id:0,title:m.title,content:m.content,published_at:K.now(),publisher_id:h.id,game_id:c.current.id};xe(c.current.id,d).then(()=>{y({level:"success",description:a("game.notification.createSuccess"),duration:5e3}),C()}).catch(n=>{n.response.text().then(o=>{y({level:"error",description:`${a("game.notification.createFailed")}: ${o}`,duration:5e3})})})},[u,x]=k(!1);function C(){x(!0),we(c.current.id).then(s).catch(m=>{m.response.text().then(d=>{y({level:"error",description:`${a("game.notification.fetchFailed")}: ${d}`,duration:5e3})})}).finally(()=>{x(!1)})}function Q(m){be(c.current.id,m).then(()=>{y({level:"success",description:a("game.notification.deleteSuccess"),duration:5e3}),C()}).catch(d=>{d.response.text().then(n=>{y({level:"error",description:`${a("game.notification.deleteFailed")}: ${n}`,duration:5e3})})}).finally(()=>{C()})}return W(()=>{c.current&&C()}),(()=>{var m=Se();return t(m,e(T,{get options(){return{scrollbars:{theme:`os-theme-${P()}`,autoHide:"scroll"}}},class:"relative w-full h-full print:h-auto print:overflow-auto",defer:!0,get children(){var d=Ce();return t(d,e(g,{get when(){return w(()=>!!(h.id&&c.current?.admins.includes(h.id)))()&&h.permissions.includes(A.Game)},get children(){return e(M,{onSubmit:v,class:"flex flex-col space-y-2",get children(){return[e(g,{get when(){return i()},get children(){return[e(p,{name:"title",get validate(){return[V(a("game.notification.titleRequired"))]},children:(n,o)=>e(oe,Y({get placeholder(){return a("game.notification.titlePlaceholder")},get title(){return a("game.notification.titlePlaceholder")}},o,{get value(){return n.value},get error(){return n.error},required:!0}))}),e(p,{name:"content",get validate(){return[V(a("game.notification.contentRequired"))]},children:n=>e(se,{form:_,class:"h-48",lang:"plaintext",placeholder:"PLAINTEXT",get title(){return a("game.notification.contentPlaceholder")},name:"content",get value(){return n.value},get error(){return n.error}})})]}}),(()=>{var n=ke();return t(n,e(g,{get when(){return i()},get children(){return e(D,{class:"flex-1",type:"submit",get children(){return[z(),(()=>{var o=N();return t(o,()=>a("form.create")),o})()]}})}}),null),t(n,e(D,{get class(){return`${i()?"flex-shrink-0":"flex-1"}`},get square(){return i()},type:"button",onClick:()=>{f(!i())},get children(){return[e(g,{get when(){return i()},get fallback(){return z()},get children(){return ye()}}),e(g,{get when(){return!i()},get children(){var o=N();return t(o,()=>a("form.create")),o}})]}}),null),n})()]}})}}),null),t(d,e(X,{get each(){return $()},get fallback(){return(()=>{var n=Ee();return t(n,e(g,{get when(){return u()},get fallback(){return[Pe(),(()=>{var o=N();return t(o,()=>a("game.noNotifications")),o})()]},get children(){return e(ce,{})}})),n})()},children:n=>(()=>{var o=Ne(),b=o.firstChild,U=b.firstChild,R=U.nextSibling;R.nextSibling;var O=b.nextSibling;return t(R,()=>n.title),t(b,e(me,{class:"flex-shrink-0 flex items-center",get href(){return`/users/${n.publisher_id}`},get children(){return Te()}}),null),t(b,e(g,{get when(){return w(()=>!!(h.id&&c.current?.admins.includes(h.id)))()&&h.permissions.includes(A.Game)},get children(){var j=je();return j.$$click=()=>Q(n.id),q(()=>B(j,"title",a("form.delete"))),j}}),null),t(o,e(ie,{}),O),t(O,()=>n.content),q(()=>B(b,"title",`${n.publisher_name} at ${n.published_at.toFormat("yyyy-MM-dd HH:mm:ss")}`)),o})()}),null),d}})),m})()}Z(["click"]);var Le=r('<span class="icon-[fluent--person-settings-20-filled] w-5 h-5 text-error">'),Ae=r("<span>"),De=r('<div class="border-b border-b-layer-content/10 px-2 h-16 flex items-center justify-center">');function Ie(){return(()=>{var l=De();return t(l,e(J,{get children(){return e(L,{get when(){return c.current?.admins.includes(h.id)},get children(){return e(D,{ghost:!0,disabled:!0,class:"w-full",justify:"start",get children(){return[Le(),(()=>{var s=Ae();return t(s,()=>a("game.adminMode")),s})()]}})}})}})),l})()}var He=r('<div class="flex flex-col">'),Me=r('<div class="flex-1 w-full relative"><div class="absolute top-0 left-0 w-full h-full overflow-hidden">');function Re(){const[l,s]=k(null),$=Object.assign({"../../_blocks/contents/welcome.en_us.md":()=>S(()=>import("./welcome.en_us-BpeuZc6f.js"),[]),"../../_blocks/contents/welcome.ja_jp.md":()=>S(()=>import("./welcome.ja_jp-BwVdDEDk.js"),[]),"../../_blocks/contents/welcome.zh_cn.md":()=>S(()=>import("./welcome.zh_cn-C3qm9_Io.js"),[]),"../../_blocks/contents/welcome.zh_tw.md":()=>S(()=>import("./welcome.zh_tw-CJ6T0HgC.js"),[])});return W(()=>{G.locale&&ee(()=>{const i=$[`../../_blocks/contents/welcome.${G.locale}.md`];i().then(f=>{s(f.default)})})}),(()=>{var i=Me(),f=i.firstChild;return t(f,e(T,{get options(){return{scrollbars:{theme:`os-theme-${P()}`,autoHide:"scroll"}}},class:"relative w-full h-full print:h-auto print:overflow-auto",defer:!0,get children(){var _=He();return t(_,e(de,{class:"self-center",get content(){return l()||""}})),_}})),i})()}var Oe=r('<span class="icon-[fluent--home-20-regular] w-5 h-5">'),F=r("<span>"),qe=r('<span class="icon-[fluent--add-20-regular] w-5 h-5">'),Be=r('<div class="h-full flex px-2 py-0 items-center space-x-2 min-w-max w-max">'),Ge=r('<div class="flex-1 flex flex-col w-0">'),Ve=r('<div class="flex flex-col">'),ze=r('<span class="icon-[fluent--code-20-regular] w-5 h-5">');function Ct(){const l=te();if(h.token===null)return l(`/account/login?redirect=/games/${c.current?c.current.id:""}`),null;const[s,$]=re(),i=w(()=>Number.parseInt(s.challenge||"NaN")||null),f=w(()=>s.create==="true"),[_,M]=k([]);return[e(ae,{get title(){return`${a("game.challenge.title")} - ${c.current?.name||"CTF"}`}}),e(le,{get leftBar(){return e(_e,{})},get rightBar(){return(()=>{var p=Ve();return t(p,e(Ie,{}),null),t(p,e(Fe,{}),null),p})()},get children(){var p=Ge();return t(p,e(T,{class:"w-full h-16 backdrop-blur border-b border-b-layer-content/10 relative",get options(){return{scrollbars:{theme:`os-theme-${P()}`,autoHide:"scroll"}}},defer:!0,get children(){var v=Be();return t(v,e(E,{get href(){return`/games/${c.current?.id}/challenges`},onClick:()=>$({challenge:null}),ghost:!0,get active(){return w(()=>i()===null)()&&f()===!1},get children(){return[Oe(),(()=>{var u=F();return t(u,()=>a("game.challenge.welcome")),u})()]}}),null),t(v,e(g,{get when(){return h.permissions.includes(A.Game)},get children(){return e(E,{get active(){return f()},get title(){return a("form.create")},ghost:!0,get href(){return`/games/${c.current?.id}/challenges?create=true`},get children(){return[qe(),(()=>{var u=F();return t(u,()=>a("form.create")),u})()]}})}}),null),t(v,e(X,{get each(){return _()},children:u=>e(E,{get href(){return`/games/${c.current?.id}/challenges?challenge=${u.id}`},onClick:()=>$({challenge:u.id}),get active(){return w(()=>u.id===i())()&&f()===!1},ghost:!0,get children(){return[ze(),(()=>{var x=F();return t(x,()=>u.name),x})()]}})}),null),v}}),null),t(p,e(J,{get fallback(){return e(Re,{})},get children(){return[e(L,{get when(){return f()},get children(){return e(ve,{})}}),e(L,{get when(){return i()!==null},get children(){return e(ne,{inGame:!0,get challenge(){return{id:i(),name:"Challenge",score:100,game_id:1,content:"Content",updated_at:K.now(),hidden:!1,tag:[{name:"Reverse",primary:!0}],score_rule:{initial:1e3,minimum:500,decay:10},bucket:""}}})}})]}}),null),p}})]}export{Ct as default};
