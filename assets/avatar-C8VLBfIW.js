import{e as c,U as I,q as g,s as u,c as k,S as R,j as E,t as f}from"./index-D-4Ec2E9.js";import{S as b}from"./spin-Cv0qhUOt.js";import{k as S,m,a as v,c as A,b as C,e as P,f as O,g as M,t as y,v as L,u as x,l as G,o as N,q as D}from"./use-environment-context-C2cuRCHg.js";import{u as U}from"./use-locale-context-Cw8uL8t2.js";const[F,p]=S({hookName:"useAvatarContext",providerName:"<AvatarProvider />"}),_=t=>{const a=p(),e=m(()=>a().getFallbackProps(),t);return c(v.span,e)},$=t=>{const a=p(),e=m(()=>a().getImageProps(),t);return c(v.img,e)};var w=A("avatar").parts("root","image","fallback"),l=w.build(),s=C({getRootId:t=>t.ids?.root??`avatar:${t.id}`,getImageId:t=>t.ids?.image??`avatar:${t.id}:image`,getFallbackId:t=>t.ids?.fallback??`avatar:${t.id}:fallback`,getRootEl:t=>s.getById(t,s.getRootId(t)),getImageEl:t=>s.getById(t,s.getImageId(t))});function q(t,a,e){const o=t.matches("loaded");return{loaded:o,setSrc(r){a({type:"SRC.SET",src:r})},setLoaded(){a({type:"IMG.LOADED",src:"api"})},setError(){a({type:"IMG.ERROR",src:"api"})},getRootProps(){return e.element({...l.root.attrs,dir:t.context.dir,id:s.getRootId(t.context)})},getImageProps(){return e.img({...l.image.attrs,hidden:!o,dir:t.context.dir,id:s.getImageId(t.context),"data-state":o?"visible":"hidden",onLoad(){a({type:"IMG.LOADED",src:"element"})},onError(){a({type:"IMG.ERROR",src:"element"})}})},getFallbackProps(){return e.element({...l.fallback.attrs,dir:t.context.dir,id:s.getFallbackId(t.context),hidden:o,"data-state":o?"hidden":"visible"})}}}function H(t){const a=P(t);return O({id:"avatar",initial:"loading",activities:["trackImageRemoval"],context:a,on:{"SRC.CHANGE":{target:"loading"},"IMG.UNMOUNT":{target:"error"}},states:{loading:{activities:["trackSrcChange"],entry:["checkImageStatus"],on:{"IMG.LOADED":{target:"loaded",actions:["invokeOnLoad"]},"IMG.ERROR":{target:"error",actions:["invokeOnError"]}}},error:{activities:["trackSrcChange"],on:{"IMG.LOADED":{target:"loaded",actions:["invokeOnLoad"]}}},loaded:{activities:["trackSrcChange"],on:{"IMG.ERROR":{target:"error",actions:["invokeOnError"]}}}}},{activities:{trackSrcChange(e,o,{send:r}){const n=s.getImageEl(e);return y(n,{attributes:["src","srcset"],callback(){r({type:"SRC.CHANGE"})}})},trackImageRemoval(e,o,{send:r}){const n=s.getRootEl(e);return L(n,{callback(i){Array.from(i[0].removedNodes).find(h=>h.matches("[data-scope=avatar][data-part=image]"))&&r({type:"IMG.UNMOUNT"})}})}},actions:{invokeOnLoad(e){e.onStatusChange?.({status:"loaded"})},invokeOnError(e){e.onStatusChange?.({status:"error"})},checkImageStatus(e,o,{send:r}){const n=s.getImageEl(e);if(n?.complete){const i=T(n)?"IMG.LOADED":"IMG.ERROR";r({type:i,src:"ssr"})}}}})}function T(t){return t.complete&&t.naturalWidth!==0&&t.naturalHeight!==0}M()(["dir","id","ids","onStatusChange","getRootNode"]);const j=t=>{const a=U(),e=x(),o=I(),r=g(()=>({id:o,dir:a().dir,getRootNode:e().getRootNode,...t})),[n,i]=G(H(r()),{context:r});return g(()=>q(n,i,N))},B=t=>{const[a,e]=D()(t,["id","ids","onStatusChange"]),o=j(a),r=m(()=>o().getRootProps(),e);return c(F,{value:o,get children(){return c(v.div,r)}})};var W=f('<div class="absolute top-0 left-0 w-full h-full flex items-center justify-center">');function Y(t){const[a,e]=u(t,["fallback","loading"]),[o,r]=u(e,["children"]),[n,i]=k(!0);return c(B,{get class(){return`avatar ${r.class}`},get children(){return[c(_,{class:"avatar-fallback",get children(){return a.fallback?.slice(0,2).toUpperCase()}}),c($,{get src(){return r.src},get alt(){return r.alt},class:"avatar-img",onLoad:()=>{i(!1)}}),g(()=>o.children),c(R,{get when(){return a.loading||r.src&&n()},get children(){var d=W();return E(d,c(b,{width:20,height:20})),d}})]}})}export{Y as A};
